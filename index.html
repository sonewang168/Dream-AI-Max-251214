<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>ğŸŒ™ AI è§£å¤¢å¤§å¸« MAX</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;600;700&family=Orbitron:wght@400;700;900&display=swap');
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        :root {
            --bg-primary: #0a0a0f; --bg-secondary: #12121a; --bg-tertiary: #1a1a25; --bg-card: #15151f;
            --text-primary: #e0e0ff; --text-secondary: #8080a0;
            --neon-cyan: #00ffff; --neon-pink: #ff00ff; --neon-purple: #bf00ff; --neon-green: #00ff80;
            --glow-cyan: rgba(0, 255, 255, 0.4); --glow-pink: rgba(255, 0, 255, 0.4);
            --border-color: #2a2a40;
            --safe-top: env(safe-area-inset-top, 47px); --safe-bottom: env(safe-area-inset-bottom, 34px);
        }
        body { font-family: 'Noto Sans TC', sans-serif; background: var(--bg-primary); color: var(--text-primary); min-height: 100vh; overflow-x: hidden; }
        .splash-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg-primary); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 9999; transition: opacity 1s, visibility 1s; }
        .splash-screen.fade-out { opacity: 0; visibility: hidden; }
        .cyber-grid { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-image: linear-gradient(var(--neon-cyan) 1px, transparent 1px), linear-gradient(90deg, var(--neon-cyan) 1px, transparent 1px); background-size: 50px 50px; opacity: 0.05; animation: gridMove 20s linear infinite; transform: rotateX(60deg) scale(2); transform-origin: center top; }
        @keyframes gridMove { 0% { background-position: 0 0; } 100% { background-position: 50px 50px; } }
        .scan-line { position: absolute; top: 0; left: 0; width: 100%; height: 4px; background: linear-gradient(90deg, transparent, var(--neon-cyan), transparent); animation: scanDown 2s linear infinite; opacity: 0.6; }
        @keyframes scanDown { 0% { top: 0; opacity: 0; } 10% { opacity: 0.6; } 90% { opacity: 0.6; } 100% { top: 100%; opacity: 0; } }
        .particles { position: absolute; width: 100%; height: 100%; overflow: hidden; }
        .particle { position: absolute; width: 2px; height: 2px; background: var(--neon-cyan); border-radius: 50%; animation: particleFloat 3s ease-in-out infinite; box-shadow: 0 0 10px var(--neon-cyan); }
        @keyframes particleFloat { 0%, 100% { transform: translateY(0) scale(1); opacity: 0.3; } 50% { transform: translateY(-20px) scale(1.5); opacity: 1; } }
        .splash-main { position: relative; z-index: 10; display: flex; flex-direction: column; align-items: center; }
        .dream-ring { position: relative; width: 160px; height: 160px; display: flex; align-items: center; justify-content: center; }
        .ring-outer { position: absolute; width: 160px; height: 160px; border: 2px solid transparent; border-top-color: var(--neon-cyan); border-right-color: var(--neon-pink); border-radius: 50%; animation: ringRotate 3s linear infinite; box-shadow: 0 0 20px var(--glow-cyan), inset 0 0 20px var(--glow-pink); }
        .ring-middle { position: absolute; width: 130px; height: 130px; border: 2px dashed var(--neon-purple); border-radius: 50%; animation: ringRotate 4s linear infinite reverse; opacity: 0.6; }
        .ring-inner { position: absolute; width: 100px; height: 100px; border: 1px solid var(--neon-cyan); border-radius: 50%; animation: ringRotate 2s linear infinite; opacity: 0.4; }
        @keyframes ringRotate { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .dream-char { font-size: 60px; font-weight: 900; background: linear-gradient(135deg, var(--neon-cyan), var(--neon-pink), var(--neon-purple)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; animation: dreamPulse 2s ease-in-out infinite; filter: drop-shadow(0 0 20px var(--glow-cyan)); }
        @keyframes dreamPulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }
        .splash-title { font-family: 'Orbitron', sans-serif; font-size: 18px; font-weight: 700; letter-spacing: 4px; margin-top: 20px; background: linear-gradient(90deg, var(--neon-cyan), var(--neon-pink)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .splash-subtitle { font-size: 10px; color: var(--text-secondary); margin-top: 6px; letter-spacing: 2px; }
        .splash-loader { width: 160px; height: 3px; background: var(--bg-tertiary); border-radius: 2px; margin-top: 30px; overflow: hidden; position: relative; }
        .splash-loader::before { content: ''; position: absolute; height: 3px; width: 0%; background: linear-gradient(90deg, var(--neon-cyan), var(--neon-pink), var(--neon-purple)); animation: loadProgress 2.5s ease-in-out forwards; }
        @keyframes loadProgress { 0% { width: 0%; } 100% { width: 100%; } }
        .splash-status { font-family: 'Orbitron', monospace; font-size: 8px; color: var(--neon-cyan); margin-top: 10px; letter-spacing: 1px; animation: statusBlink 0.5s step-end infinite; }
        @keyframes statusBlink { 0%, 100% { opacity: 1; } 50% { opacity: 0; } }
        .app-container { max-width: 430px; margin: 0 auto; min-height: 100vh; background: var(--bg-primary); position: relative; padding-bottom: calc(70px + var(--safe-bottom)); }
        .status-bar { height: var(--safe-top); background: linear-gradient(180deg, rgba(0,0,0,0.8), transparent); position: sticky; top: 0; z-index: 100; }
        .dynamic-island { position: fixed; top: 10px; left: 50%; transform: translateX(-50%); width: 110px; height: 30px; background: #000; border-radius: 16px; z-index: 101; display: flex; align-items: center; justify-content: center; box-shadow: 0 0 12px rgba(0, 255, 255, 0.2); }
        .dynamic-island-content { font-size: 8px; color: var(--neon-cyan); font-family: 'Orbitron', monospace; }
        .page { display: none; padding: 14px; padding-top: calc(var(--safe-top) + 42px); animation: fadeIn 0.3s ease; }
        .page.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .header { text-align: center; margin-bottom: 16px; }
        .header-icon { font-size: 40px; margin-bottom: 8px; animation: iconFloat 3s ease-in-out infinite; }
        @keyframes iconFloat { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-5px); } }
        .header h1 { font-size: 20px; font-weight: 700; background: linear-gradient(135deg, var(--neon-cyan), var(--neon-pink)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .header p { color: var(--text-secondary); font-size: 11px; margin-top: 3px; }
        .card { background: var(--bg-card); border-radius: 12px; padding: 14px; margin-bottom: 12px; border: 1px solid var(--border-color); position: relative; overflow: hidden; }
        .card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 2px; background: linear-gradient(90deg, var(--neon-cyan), var(--neon-pink), var(--neon-purple)); opacity: 0.6; }
        .card-title { font-size: 13px; font-weight: 600; margin-bottom: 10px; display: flex; align-items: center; gap: 5px; }
        .dream-count-badge { font-size: 9px; background: linear-gradient(135deg, var(--neon-pink), var(--neon-purple)); color: #fff; padding: 2px 6px; border-radius: 8px; margin-left: auto; }
        .input-tabs { display: flex; gap: 5px; margin-bottom: 10px; }
        .input-tab { flex: 1; padding: 7px; background: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: 8px; color: var(--text-secondary); font-size: 10px; cursor: pointer; transition: all 0.2s; text-align: center; }
        .input-tab.active { background: var(--bg-tertiary); border-color: var(--neon-cyan); color: var(--neon-cyan); box-shadow: 0 0 10px var(--glow-cyan); }
        .input-tab .icon { font-size: 14px; display: block; margin-bottom: 1px; }
        .input-panel { display: none; }
        .input-panel.active { display: block; }
        .dream-textarea { width: 100%; min-height: 80px; padding: 10px; background: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: 8px; color: var(--text-primary); font-size: 13px; font-family: inherit; resize: none; outline: none; transition: all 0.3s; }
        .dream-textarea:focus { border-color: var(--neon-cyan); box-shadow: 0 0 12px var(--glow-cyan); }
        .dream-textarea::placeholder { color: var(--text-secondary); }
        .char-count { text-align: right; font-size: 9px; color: var(--text-secondary); margin-top: 3px; }
        .upload-area { border: 2px dashed var(--border-color); border-radius: 8px; padding: 16px; text-align: center; cursor: pointer; transition: all 0.3s; }
        .upload-area:hover { border-color: var(--neon-cyan); background: rgba(0, 255, 255, 0.05); }
        .upload-area .icon { font-size: 28px; margin-bottom: 6px; }
        .upload-area p { color: var(--text-secondary); font-size: 11px; }
        .file-preview, .image-preview { display: none; background: var(--bg-secondary); border-radius: 8px; padding: 10px; margin-top: 8px; }
        .file-preview.show, .image-preview.show { display: block; }
        .file-preview .file-info { display: flex; align-items: center; gap: 6px; }
        .file-preview .file-icon { font-size: 20px; }
        .file-preview .file-name { flex: 1; font-size: 11px; word-break: break-all; }
        .file-preview .file-remove, .image-preview .remove-btn { background: var(--bg-tertiary); border: none; color: #ff6666; padding: 4px 8px; border-radius: 5px; cursor: pointer; font-size: 10px; }
        .image-preview img { width: 100%; max-height: 120px; object-fit: contain; border-radius: 8px; border: 1px solid var(--border-color); }
        .image-preview .remove-btn { display: block; width: 100%; margin-top: 6px; border: 1px solid #ff6666; }
        .dream-search { width: 100%; padding: 8px 10px; background: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: 8px; color: var(--text-primary); font-size: 11px; outline: none; margin-bottom: 8px; }
        .dream-search:focus { border-color: var(--neon-cyan); }
        .dream-search::placeholder { color: var(--text-secondary); }
        .category-tabs { display: flex; gap: 4px; overflow-x: auto; padding-bottom: 6px; margin-bottom: 6px; -webkit-overflow-scrolling: touch; }
        .category-tabs::-webkit-scrollbar { display: none; }
        .category-tab { flex-shrink: 0; padding: 4px 8px; background: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: 10px; color: var(--text-secondary); font-size: 9px; cursor: pointer; transition: all 0.2s; white-space: nowrap; }
        .category-tab.active { background: var(--bg-tertiary); border-color: var(--neon-pink); color: var(--neon-pink); }
        .dream-types-container { max-height: 160px; overflow-y: auto; padding: 2px; margin: -2px; }
        .dream-types-container::-webkit-scrollbar { width: 2px; }
        .dream-types-container::-webkit-scrollbar-track { background: var(--bg-secondary); border-radius: 1px; }
        .dream-types-container::-webkit-scrollbar-thumb { background: var(--neon-cyan); border-radius: 1px; }
        .dream-category { margin-bottom: 6px; }
        .dream-category-title { font-size: 9px; color: var(--neon-pink); margin-bottom: 4px; padding-left: 2px; }
        .dream-types { display: grid; grid-template-columns: repeat(5, 1fr); gap: 3px; }
        .dream-type { padding: 4px 1px; background: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: 5px; text-align: center; cursor: pointer; transition: all 0.2s; }
        .dream-type:hover { border-color: var(--neon-cyan); }
        .dream-type.selected { border-color: var(--neon-pink); background: rgba(255, 0, 255, 0.1); box-shadow: 0 0 6px var(--glow-pink); }
        .dream-type.hidden { display: none; }
        .dream-type .icon { font-size: 12px; }
        .dream-type .label { font-size: 7px; color: var(--text-secondary); line-height: 1.1; }
        .dream-type.selected .label { color: var(--neon-pink); }
        .btn { width: 100%; padding: 11px; border: none; border-radius: 10px; font-size: 13px; font-weight: 600; cursor: pointer; transition: all 0.3s; font-family: inherit; }
        .btn-primary { background: linear-gradient(135deg, var(--neon-cyan), var(--neon-purple)); color: #000; box-shadow: 0 3px 12px var(--glow-cyan); }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 5px 20px var(--glow-cyan); }
        .btn-primary:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
        .btn-secondary { background: var(--bg-tertiary); color: var(--text-primary); border: 1px solid var(--border-color); }
        .btn-success { background: linear-gradient(135deg, var(--neon-green), #00cc66); color: #000; }
        .btn-danger { background: linear-gradient(135deg, #ff6666, #cc3333); color: #fff; }
        .loading { display: none; flex-direction: column; align-items: center; justify-content: center; padding: 35px 20px; }
        .loading.show { display: flex; }
        .dream-loader { width: 50px; height: 50px; position: relative; }
        .dream-loader .orbit { position: absolute; width: 100%; height: 100%; border: 2px solid transparent; border-radius: 50%; animation: orbitSpin 1.5s linear infinite; }
        .dream-loader .orbit:nth-child(1) { border-top-color: var(--neon-cyan); }
        .dream-loader .orbit:nth-child(2) { width: 36px; height: 36px; top: 7px; left: 7px; border-right-color: var(--neon-pink); animation-duration: 1s; animation-direction: reverse; }
        .dream-loader .orbit:nth-child(3) { width: 22px; height: 22px; top: 14px; left: 14px; border-bottom-color: var(--neon-purple); animation-duration: 0.7s; }
        .dream-loader .core { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 14px; animation: corePulse 1s ease-in-out infinite; }
        @keyframes orbitSpin { to { transform: rotate(360deg); } }
        @keyframes corePulse { 0%, 100% { opacity: 0.5; } 50% { opacity: 1; } }
        .loading-text { margin-top: 12px; color: var(--text-secondary); font-size: 11px; animation: textPulse 1.5s ease-in-out infinite; }
        @keyframes textPulse { 0%, 100% { opacity: 0.5; } 50% { opacity: 1; } }
        .result-area { display: none; }
        .result-area.show { display: block; animation: resultSlide 0.5s ease; }
        @keyframes resultSlide { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .dream-result-card { background: linear-gradient(135deg, var(--bg-card), var(--bg-secondary)); border-radius: 14px; padding: 16px; margin-bottom: 10px; border: 1px solid var(--border-color); position: relative; overflow: hidden; }
        .dream-result-card::before { content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%; background: conic-gradient(from 0deg, transparent, var(--neon-cyan), transparent, var(--neon-pink), transparent); animation: borderRotate 4s linear infinite; opacity: 0.1; }
        @keyframes borderRotate { to { transform: rotate(360deg); } }
        .result-header { display: flex; align-items: center; gap: 8px; margin-bottom: 10px; position: relative; z-index: 1; }
        .result-icon { width: 38px; height: 38px; background: linear-gradient(135deg, var(--neon-purple), var(--neon-pink)); border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 18px; }
        .result-title-area h2 { font-size: 14px; margin-bottom: 2px; }
        .result-title-area .dream-type-label { font-size: 9px; color: var(--neon-cyan); background: rgba(0, 255, 255, 0.1); padding: 1px 6px; border-radius: 6px; display: inline-block; }
        .dream-scores { display: grid; grid-template-columns: repeat(3, 1fr); gap: 6px; margin: 12px 0; position: relative; z-index: 1; }
        .score-item { background: var(--bg-tertiary); border-radius: 8px; padding: 8px 4px; text-align: center; }
        .score-item .score-icon { font-size: 14px; margin-bottom: 2px; }
        .score-item .score-value { font-size: 18px; font-weight: 700; background: linear-gradient(135deg, var(--neon-cyan), var(--neon-pink)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .score-item .score-label { font-size: 8px; color: var(--text-secondary); margin-top: 1px; }
        .interpretation-section { background: var(--bg-tertiary); border-radius: 8px; padding: 10px; margin-bottom: 6px; position: relative; z-index: 1; }
        .interpretation-section h3 { font-size: 11px; color: var(--neon-cyan); margin-bottom: 5px; display: flex; align-items: center; gap: 4px; }
        .interpretation-section p { font-size: 11px; line-height: 1.5; color: var(--text-primary); }
        .lucky-elements { display: grid; grid-template-columns: repeat(2, 1fr); gap: 5px; margin-top: 10px; position: relative; z-index: 1; }
        .lucky-item { background: var(--bg-secondary); border-radius: 6px; padding: 6px; display: flex; align-items: center; gap: 5px; }
        .lucky-item .icon { font-size: 16px; }
        .lucky-item .info .label { font-size: 8px; color: var(--text-secondary); }
        .lucky-item .info .value { font-size: 11px; font-weight: 600; color: var(--neon-pink); }
        .tts-mode-indicator { text-align: center; font-size: 9px; color: var(--text-secondary); margin-bottom: 5px; }
        .tts-mode-indicator span { color: var(--neon-cyan); }
        .voice-controls { display: flex; gap: 5px; margin-bottom: 10px; }
        .voice-btn { flex: 1; padding: 9px 3px; border: none; border-radius: 8px; font-size: 11px; font-weight: 600; cursor: pointer; transition: all 0.2s; font-family: inherit; }
        .voice-btn:disabled { opacity: 0.4; cursor: not-allowed; }
        .voice-btn.play { background: linear-gradient(135deg, var(--neon-green), #00cc66); color: #000; }
        .voice-btn.pause { background: linear-gradient(135deg, #f39c12, #e67e22); color: #000; }
        .voice-btn.stop { background: linear-gradient(135deg, #e74c3c, #c0392b); color: #fff; }
        .voice-btn:not(:disabled):active { transform: scale(0.95); }
        .share-buttons { display: flex; gap: 6px; }
        .share-buttons .btn { flex: 1; }
        .history-list { display: flex; flex-direction: column; gap: 6px; }
        .history-item { background: var(--bg-card); border-radius: 8px; padding: 10px; border: 1px solid var(--border-color); cursor: pointer; transition: all 0.2s; }
        .history-item:hover { border-color: var(--neon-cyan); transform: translateX(2px); }
        .history-item .date { font-size: 8px; color: var(--text-secondary); margin-bottom: 2px; }
        .history-item .dream-preview { font-size: 11px; color: var(--text-primary); display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
        .history-item .type-tag { display: inline-block; font-size: 7px; background: var(--bg-tertiary); color: var(--neon-cyan); padding: 1px 5px; border-radius: 5px; margin-top: 4px; }
        .history-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .clear-history-btn { background: none; border: 1px solid #ff6666; color: #ff6666; padding: 4px 10px; border-radius: 5px; font-size: 9px; cursor: pointer; }
        .setting-item { background: var(--bg-card); border-radius: 10px; padding: 10px; margin-bottom: 8px; border: 1px solid var(--border-color); }
        .setting-item label { display: block; font-size: 11px; margin-bottom: 5px; color: var(--text-secondary); }
        .setting-item input { width: 100%; padding: 8px; background: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: 5px; color: var(--text-primary); font-size: 11px; outline: none; }
        .setting-item input:focus { border-color: var(--neon-cyan); }
        .api-status { display: flex; align-items: center; gap: 4px; margin-top: 4px; font-size: 9px; }
        .api-status .dot { width: 6px; height: 6px; border-radius: 50%; background: #ff6666; }
        .api-status .dot.active { background: var(--neon-green); }
        .tts-modes { display: flex; flex-direction: column; gap: 5px; }
        .tts-mode { display: flex; align-items: center; gap: 6px; padding: 8px; background: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: 8px; cursor: pointer; transition: all 0.2s; }
        .tts-mode:hover { border-color: var(--neon-cyan); }
        .tts-mode.selected { border-color: var(--neon-pink); background: rgba(255, 0, 255, 0.1); box-shadow: 0 0 10px var(--glow-pink); }
        .tts-mode .tts-icon { font-size: 18px; width: 24px; text-align: center; }
        .tts-mode .tts-info { flex: 1; }
        .tts-mode .tts-name { font-size: 12px; font-weight: 600; color: var(--text-primary); }
        .tts-mode .tts-desc { font-size: 9px; color: var(--text-secondary); }
        .tts-mode.selected .tts-name { color: var(--neon-pink); }
        .tts-settings { border-top: 1px solid var(--border-color); margin-top: 10px; padding-top: 10px; }
        .bottom-nav { position: fixed; bottom: 0; left: 0; right: 0; max-width: 430px; margin: 0 auto; background: rgba(10, 10, 15, 0.95); backdrop-filter: blur(20px); padding: 6px 20px calc(6px + var(--safe-bottom)); display: flex; justify-content: space-around; border-top: 1px solid var(--border-color); z-index: 100; }
        .nav-item { text-align: center; cursor: pointer; opacity: 0.5; transition: all 0.2s; padding: 4px 14px; }
        .nav-item.active { opacity: 1; }
        .nav-item .icon { font-size: 18px; margin-bottom: 1px; }
        .nav-item .label { font-size: 8px; color: var(--text-secondary); }
        .nav-item.active .label { color: var(--neon-cyan); }
        .toast { position: fixed; bottom: 90px; left: 50%; transform: translateX(-50%) translateY(100px); background: var(--bg-tertiary); color: var(--text-primary); padding: 7px 16px; border-radius: 18px; font-size: 11px; z-index: 1000; opacity: 0; transition: all 0.3s; border: 1px solid var(--neon-cyan); box-shadow: 0 3px 12px var(--glow-cyan); }
        .toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }
        .empty-state { text-align: center; padding: 35px 20px; color: var(--text-secondary); }
        .empty-state .icon { font-size: 35px; margin-bottom: 10px; opacity: 0.3; }
        .error-box { background: rgba(255, 102, 102, 0.1); border: 1px solid #ff6666; border-radius: 8px; padding: 10px; margin-bottom: 10px; display: none; }
        .error-box.show { display: block; }
        .error-box p { color: #ff6666; font-size: 11px; }
    </style>
</head>
<body>
    <div class="splash-screen" id="splashScreen">
        <div class="cyber-grid"></div><div class="scan-line"></div><div class="particles" id="particles"></div>
        <div class="splash-main">
            <div class="dream-ring"><div class="ring-outer"></div><div class="ring-middle"></div><div class="ring-inner"></div><div class="dream-char">å¤¢</div></div>
            <div class="splash-title">DREAM AI MAX</div>
            <div class="splash-subtitle">çµ‚æ¥µç‰ˆ Â· 361 ç¨®å¤¢å¢ƒ</div>
            <div class="splash-loader"></div>
            <div class="splash-status">LOADING DREAM DATABASE...</div>
        </div>
    </div>
    <div class="app-container">
        <div class="status-bar"></div>
        <div class="dynamic-island"><div class="dynamic-island-content">ğŸŒ™ DREAM MAX</div></div>
        <div class="page active" id="page-home">
            <div class="header"><div class="header-icon">ğŸŒ™</div><h1>AI è§£å¤¢å¤§å¸«</h1><p>MAX çµ‚æ¥µç‰ˆ Â· å²ä¸Šæœ€å®Œæ•´</p></div>
            <div class="error-box" id="errorBox"><p id="errorMessage">è«‹å…ˆè¨­å®š Groq API Key</p></div>
            <div class="card">
                <div class="card-title">ğŸ“ æè¿°å¤¢å¢ƒ</div>
                <div class="input-tabs">
                    <div class="input-tab active" onclick="switchInputTab('text')"><span class="icon">âœï¸</span><span>æ–‡å­—</span></div>
                    <div class="input-tab" onclick="switchInputTab('file')"><span class="icon">ğŸ“„</span><span>æª”æ¡ˆ</span></div>
                    <div class="input-tab" onclick="switchInputTab('image')"><span class="icon">ğŸ–¼ï¸</span><span>åœ–ç‰‡</span></div>
                </div>
                <div class="input-panel active" id="panel-text">
                    <textarea class="dream-textarea" id="dreamInput" placeholder="è©³ç´°æè¿°ä½ çš„å¤¢å¢ƒ..." maxlength="2000" oninput="updateCharCount()"></textarea>
                    <div class="char-count"><span id="charCount">0</span>/2000</div>
                </div>
                <div class="input-panel" id="panel-file">
                    <div class="upload-area" onclick="document.getElementById('fileInput').click()"><div class="icon">ğŸ“„</div><p>ä¸Šå‚³ .txt</p></div>
                    <input type="file" id="fileInput" accept=".txt" style="display:none" onchange="handleFileUpload(event)">
                    <div class="file-preview" id="filePreview"><div class="file-info"><span class="file-icon">ğŸ“„</span><span class="file-name" id="fileName"></span><button class="file-remove" onclick="removeFile()">âœ•</button></div></div>
                </div>
                <div class="input-panel" id="panel-image">
                    <div class="upload-area" onclick="document.getElementById('imageInput').click()"><div class="icon">ğŸ–¼ï¸</div><p>ä¸Šå‚³åœ–ç‰‡</p></div>
                    <input type="file" id="imageInput" accept="image/*" style="display:none" onchange="handleImageUpload(event)">
                    <div class="image-preview" id="imagePreview"><img id="previewImg" src=""><button class="remove-btn" onclick="removeImage()">âœ•</button></div>
                </div>
                <button class="btn btn-secondary" onclick="clearInput()" style="margin-top:10px;font-size:11px;padding:8px;">ğŸ—‘ï¸ æ¸…é™¤è¼¸å…¥</button>
            </div>
            <div class="card">
                <div class="card-title">ğŸ·ï¸ å¤¢å¢ƒé¡å‹<span class="dream-count-badge" id="dreamCountBadge">361ç¨®</span></div>
                <input type="text" class="dream-search" id="dreamSearch" placeholder="ğŸ” æœå°‹..." oninput="filterDreamTypes()">
                <div class="category-tabs" id="categoryTabs"></div>
                <div class="dream-types-container" id="dreamTypesContainer"></div>
            </div>
            <button class="btn btn-primary" id="analyzeBtn" onclick="analyzeDream()" disabled>ğŸ”® é–‹å§‹è§£å¤¢</button>
            <div class="loading" id="loadingArea"><div class="dream-loader"><div class="orbit"></div><div class="orbit"></div><div class="orbit"></div><div class="core">ğŸŒ™</div></div><div class="loading-text" id="loadingText">é€£çµæ½›æ„è­˜...</div></div>
            <div class="result-area" id="resultArea">
                <div class="dream-result-card">
                    <div class="result-header"><div class="result-icon">ğŸŒ™</div><div class="result-title-area"><h2 id="resultTitle">å¤¢å¢ƒè§£æ</h2><span class="dream-type-label" id="resultTypeLabel">ä¸€èˆ¬</span></div></div>
                    <div class="dream-scores">
                        <div class="score-item"><div class="score-icon">ğŸ’«</div><div class="score-value" id="scorePositive">--</div><div class="score-label">æ­£å‘</div></div>
                        <div class="score-item"><div class="score-icon">ğŸ§ </div><div class="score-value" id="scorePsychology">--</div><div class="score-label">å¿ƒç†</div></div>
                        <div class="score-item"><div class="score-icon">ğŸ”®</div><div class="score-value" id="scoreProphetic">--</div><div class="score-label">é ç¤º</div></div>
                    </div>
                    <div class="interpretation-section"><h3>ğŸŒ™ è±¡å¾µ</h3><p id="symbolMeaning">...</p></div>
                    <div class="interpretation-section"><h3>ğŸ§  å¿ƒç†</h3><p id="psychoAnalysis">...</p></div>
                    <div class="interpretation-section"><h3>ğŸ”® å»ºè­°</h3><p id="prediction">...</p></div>
                    <div class="lucky-elements">
                        <div class="lucky-item"><div class="icon">ğŸ¨</div><div class="info"><div class="label">é¡è‰²</div><div class="value" id="luckyColor">--</div></div></div>
                        <div class="lucky-item"><div class="icon">ğŸ”¢</div><div class="info"><div class="label">æ•¸å­—</div><div class="value" id="luckyNumber">--</div></div></div>
                        <div class="lucky-item"><div class="icon">â°</div><div class="info"><div class="label">æ™‚è¾°</div><div class="value" id="luckyTime">--</div></div></div>
                        <div class="lucky-item"><div class="icon">ğŸ§¿</div><div class="info"><div class="label">è­·èº«</div><div class="value" id="luckyCharm">--</div></div></div>
                    </div>
                </div>
                <div class="tts-mode-indicator">èªéŸ³ï¼š<span id="currentTTSMode">Web</span></div>
                <div class="voice-controls">
                    <button class="voice-btn play" id="playBtn" onclick="speakResult()">â–¶ï¸ æ’­æ”¾</button>
                    <button class="voice-btn pause" id="pauseBtn" onclick="pauseSpeech()" disabled>â¸ï¸</button>
                    <button class="voice-btn stop" id="stopBtn" onclick="stopSpeech()" disabled>â¹ï¸</button>
                </div>
                <div class="share-buttons"><button class="btn btn-success" onclick="sendToLine()">ğŸ“± LINE</button></div>
                <button class="btn btn-danger" onclick="resetDream()" style="margin-top:6px;">ğŸ”„ æ¸…é™¤</button>
            </div>
        </div>
        <div class="page" id="page-history">
            <div class="header"><div class="header-icon">ğŸ“œ</div><h1>å¤¢å¢ƒè¨˜éŒ„</h1></div>
            <div class="history-header"><span id="historyCount">0ç­†</span><button class="clear-history-btn" onclick="clearAllHistory()">ğŸ—‘ï¸</button></div>
            <div class="history-list" id="historyList"><div class="empty-state"><div class="icon">ğŸŒ™</div><p>å°šç„¡è¨˜éŒ„</p></div></div>
        </div>
        <div class="page" id="page-settings">
            <div class="header"><div class="header-icon">âš™ï¸</div><h1>è¨­å®š</h1></div>
            <div class="card">
                <div class="card-title">ğŸ¤– AIï¼ˆå¿…å¡«ï¼‰</div>
                <div class="setting-item" style="margin:0;border:none;padding:0;"><label>Groq API Key</label><input type="password" id="groqApiKey" placeholder="gsk_..." onchange="saveSettings()"><div class="api-status"><span class="dot" id="groqStatus"></span><span id="groqStatusText">æœªè¨­å®š</span></div></div>
                <div style="margin-top:12px;"><label style="font-size:10px;color:var(--text-secondary);margin-bottom:6px;display:block;">ğŸ§  AI æ¨¡å‹ï¼ˆåœ–ç‰‡è§£å¤¢ç”¨ï¼‰</label>
                <div class="tts-modes" id="modelModes">
                    <div class="tts-mode selected" data-model="llama4-scout" onclick="selectAIModel('llama4-scout')"><div class="tts-icon">ğŸ¦™</div><div class="tts-info"><div class="tts-name">Llama 4 Scout</div><div class="tts-desc">Groqãƒ»å…è²»</div></div></div>
                    <div class="tts-mode" data-model="llama4-maverick" onclick="selectAIModel('llama4-maverick')"><div class="tts-icon">ğŸ¦™</div><div class="tts-info"><div class="tts-name">Llama 4 Maverick</div><div class="tts-desc">Groqãƒ»å…è²»</div></div></div>
                    <div class="tts-mode" data-model="gemini-2.0-flash" onclick="selectAIModel('gemini-2.0-flash')"><div class="tts-icon">ğŸ’</div><div class="tts-info"><div class="tts-name">Gemini 2.0 Flash</div><div class="tts-desc">Googleãƒ»å…è²»</div></div></div>
                    <div class="tts-mode" data-model="gemini-2.5-flash" onclick="selectAIModel('gemini-2.5-flash')"><div class="tts-icon">ğŸ’</div><div class="tts-info"><div class="tts-name">Gemini 2.5 Flash</div><div class="tts-desc">Googleãƒ»å…è²»</div></div></div>
                    <div class="tts-mode" data-model="gemini-2.5-pro" onclick="selectAIModel('gemini-2.5-pro')"><div class="tts-icon">ğŸ’</div><div class="tts-info"><div class="tts-name">Gemini 2.5 Pro</div><div class="tts-desc">Googleãƒ»ğŸ’°ä»˜è²»</div></div></div>
                    <div class="tts-mode" data-model="gemini-3.0-pro" onclick="selectAIModel('gemini-3.0-pro')"><div class="tts-icon">ğŸ’</div><div class="tts-info"><div class="tts-name">Gemini 3.0 Pro</div><div class="tts-desc">Googleãƒ»ğŸ’°ä»˜è²»</div></div></div>
                </div></div>
            </div>
            <div class="card">
                <div class="card-title">ğŸ”Š èªéŸ³æ’­å ±</div>
                <div class="tts-modes">
                    <div class="tts-mode selected" data-mode="web" onclick="selectTTSMode('web')"><div class="tts-icon">ğŸŒ</div><div class="tts-info"><div class="tts-name">Web</div><div class="tts-desc">å…è²»ãƒ»ç€è¦½å™¨</div></div></div>
                    <div class="tts-mode" data-mode="gemini" onclick="selectTTSMode('gemini')"><div class="tts-icon">ğŸ’</div><div class="tts-info"><div class="tts-name">Gemini</div><div class="tts-desc">é«˜å“è³ªãƒ»8ç¨®è²éŸ³</div></div></div>
                    <div class="tts-mode" data-mode="elevenlabs" onclick="selectTTSMode('elevenlabs')"><div class="tts-icon">ğŸ™ï¸</div><div class="tts-info"><div class="tts-name">ElevenLabs</div><div class="tts-desc">è¶…æ“¬çœŸãƒ»å¤šèªè¨€</div></div></div>
                </div>
                <div id="currentVoiceInfo" style="text-align:center;font-size:10px;color:var(--neon-cyan);margin:8px 0;padding:6px;background:var(--bg-secondary);border-radius:6px;">ğŸ”Š ç•¶å‰ï¼šWeb èªéŸ³ï¼ˆç€è¦½å™¨å…§å»ºï¼‰</div>
                <div class="tts-settings" id="geminiSettings" style="display:none;">
                    <label style="font-size:10px;color:var(--text-secondary);margin-bottom:4px;display:block;">ğŸ’ Gemini API Key</label>
                    <input type="password" id="geminiApiKey" placeholder="AIza..." style="width:100%;padding:7px;background:var(--bg-secondary);border:1px solid var(--border-color);border-radius:5px;color:var(--text-primary);font-size:11px;margin-bottom:8px;">
                    <label style="font-size:10px;color:var(--text-secondary);margin-bottom:4px;display:block;">ğŸ—£ï¸ è²éŸ³æ¨¡å‹</label>
                    <select id="geminiVoice" style="width:100%;padding:8px;background:var(--bg-secondary);border:1px solid var(--border-color);border-radius:5px;color:var(--text-primary);font-size:11px;margin-bottom:8px;">
                        <option value="Aoede">ğŸ‘© Aoede - è‡ªç„¶æ¸…æ–°ï¼ˆå¥³ï¼‰</option>
                        <option value="Kore">ğŸ‘© Kore - å …å®šè‡ªä¿¡ï¼ˆå¥³ï¼‰</option>
                        <option value="Leda">ğŸ‘© Leda - å¹´è¼•æ´»åŠ›ï¼ˆå¥³ï¼‰</option>
                        <option value="Zephyr">ğŸ‘© Zephyr - æ˜äº®æ„‰å¿«ï¼ˆå¥³ï¼‰</option>
                        <option value="Charon">ğŸ‘¨ Charon - å°ˆæ¥­æ¸…æ™°ï¼ˆç”·ï¼‰</option>
                        <option value="Fenrir">ğŸ‘¨ Fenrir - èˆˆå¥®æ´»åŠ›ï¼ˆç”·ï¼‰</option>
                        <option value="Orus">ğŸ‘¨ Orus - å …å®šæœæ–·ï¼ˆç”·ï¼‰</option>
                        <option value="Puck">ğŸ‘¨ Puck - æ´»æ½‘è¼•å¿«ï¼ˆç”·ï¼‰</option>
                    </select>
                    <div style="display:flex;gap:6px;">
                        <button class="btn btn-success" onclick="saveGeminiSettings()" style="flex:1;padding:8px;font-size:11px;">ğŸ’¾ å„²å­˜</button>
                        <button class="btn btn-secondary" onclick="testGeminiTTS()" style="flex:1;padding:8px;font-size:11px;">ğŸ”Š æ¸¬è©¦</button>
                    </div>
                </div>
                <div class="tts-settings" id="elevenlabsSettings" style="display:none;">
                    <label style="font-size:10px;color:var(--text-secondary);margin-bottom:4px;display:block;">ğŸ™ï¸ ElevenLabs API Key</label>
                    <input type="password" id="elevenLabsApiKey" placeholder="sk_..." style="width:100%;padding:7px;background:var(--bg-secondary);border:1px solid var(--border-color);border-radius:5px;color:var(--text-primary);font-size:11px;margin-bottom:8px;">
                    <label style="font-size:10px;color:var(--text-secondary);margin-bottom:4px;display:block;">ğŸ—£ï¸ è²éŸ³æ¨¡å‹</label>
                    <select id="elevenLabsVoice" style="width:100%;padding:8px;background:var(--bg-secondary);border:1px solid var(--border-color);border-radius:5px;color:var(--text-primary);font-size:11px;margin-bottom:8px;">
                        <option value="pFZP5JQG7iQjIQuC4Bku">ğŸ‘© Lily - æº«æŸ”å¥³è²</option>
                        <option value="EXAVITQu4vr4xnSDxMaL">ğŸ‘© Sarah - æŸ”å’Œæ–°è</option>
                        <option value="21m00Tcm4TlvDq8ikWAM">ğŸ‘© Rachel - ç¾å¼å¥³è²</option>
                        <option value="AZnzlk1XvdvUeBnXmlld">ğŸ‘© Domi - æ´»åŠ›å¥³è²</option>
                        <option value="MF3mGyEYCl7XYWbV9V6O">ğŸ‘© Elli - å¹´è¼•å¥³è²</option>
                        <option value="TxGEqnHWrfWFTfGW9XjX">ğŸ‘¨ Josh - æ·±æ²‰ç”·è²</option>
                        <option value="VR6AewLTigWG4xSOukaG">ğŸ‘¨ Arnold - æ¸¾åšç”·è²</option>
                        <option value="pNInz6obpgDQGcFmaJgB">ğŸ‘¨ Adam - å°ˆæ¥­ç”·è²</option>
                        <option value="yoZ06aMxZJJ28mfd3POQ">ğŸ‘¨ Sam - æ•˜äº‹ç”·è²</option>
                        <option value="onwK4e9ZLuTAKqWW03F9">ğŸ‘¨ Daniel - è‹±å¼ç”·è²</option>
                    </select>
                    <label style="font-size:10px;color:var(--text-secondary);margin-bottom:4px;display:block;">ğŸ”§ è‡ªè¨‚ Voice IDï¼ˆé¸å¡«ï¼‰</label>
                    <input type="text" id="elevenLabsCustomId" placeholder="ç•™ç©ºå‰‡ä½¿ç”¨ä¸Šæ–¹é¸æ“‡" style="width:100%;padding:7px;background:var(--bg-secondary);border:1px solid var(--border-color);border-radius:5px;color:var(--text-primary);font-size:11px;margin-bottom:8px;">
                    <div style="display:flex;gap:6px;">
                        <button class="btn btn-success" onclick="saveElevenLabsSettings()" style="flex:1;padding:8px;font-size:11px;">ğŸ’¾ å„²å­˜</button>
                        <button class="btn btn-secondary" onclick="testElevenLabsTTS()" style="flex:1;padding:8px;font-size:11px;">ğŸ”Š æ¸¬è©¦</button>
                    </div>
                </div>
                <div class="tts-settings" id="webSettings" style="display:block;margin-top:10px;">
                    <div style="display:flex;gap:6px;">
                        <button class="btn btn-secondary" onclick="testWebTTS()" style="flex:1;padding:8px;font-size:11px;">ğŸ”Š æ¸¬è©¦ Web èªéŸ³</button>
                    </div>
                </div>
            </div>
            <div class="card"><div class="card-title">ğŸ“± LINE</div><div class="setting-item" style="margin:0;border:none;padding:0;"><label>GAS URL</label><input type="text" id="gasUrl" placeholder="https://script.google.com/..." onchange="saveSettings()"></div></div>
            <button class="btn btn-primary" onclick="testGroqAPI()">ğŸ”— æ¸¬è©¦ AI é€£ç·š</button>
        </div>
        <div class="bottom-nav">
            <div class="nav-item active" onclick="showPage('home')"><div class="icon">ğŸŒ™</div><div class="label">è§£å¤¢</div></div>
            <div class="nav-item" onclick="showPage('history')"><div class="icon">ğŸ“œ</div><div class="label">è¨˜éŒ„</div></div>
            <div class="nav-item" onclick="showPage('settings')"><div class="icon">âš™ï¸</div><div class="label">è¨­å®š</div></div>
        </div>
    </div>
    <div class="toast" id="toast"></div>
    <script>
        // 361 ç¨®å¤¢å¢ƒé¡å‹
        const dreamCategories = [
            { id: 'common', title: 'ğŸ’« å¸¸è¦‹', types: [
                { id: 'general', icon: 'ğŸŒ€', label: 'ä¸€èˆ¬' }, { id: 'nightmare', icon: 'ğŸ‘»', label: 'æƒ¡å¤¢' }, { id: 'recurring', icon: 'ğŸ”„', label: 'é‡è¤‡' },
                { id: 'lucid', icon: 'âœ¨', label: 'æ¸…é†’' }, { id: 'vivid', icon: 'ğŸŒˆ', label: 'é®®æ˜' }, { id: 'prophetic', icon: 'ğŸ”®', label: 'é çŸ¥' },
                { id: 'symbolic', icon: 'ğŸ­', label: 'è±¡å¾µ' }, { id: 'healing', icon: 'ğŸ’š', label: 'ç™‚ç™’' }, { id: 'warning', icon: 'âš ï¸', label: 'è­¦ç¤º' }, { id: 'wishful', icon: 'ğŸŒŸ', label: 'é¡˜æœ›' }
            ]},
            { id: 'action', title: 'ğŸƒ å‹•ä½œ', types: [
                { id: 'flying', icon: 'ğŸ¦…', label: 'é£›ç¿”' }, { id: 'falling', icon: 'â¬‡ï¸', label: 'å¢œè½' }, { id: 'chased', icon: 'ğŸƒ', label: 'è¢«è¿½' },
                { id: 'running', icon: 'ğŸ’¨', label: 'å¥”è·‘' }, { id: 'swimming', icon: 'ğŸŠ', label: 'æ¸¸æ³³' }, { id: 'climbing', icon: 'ğŸ§—', label: 'æ”€çˆ¬' },
                { id: 'driving', icon: 'ğŸš—', label: 'é–‹è»Š' }, { id: 'dancing', icon: 'ğŸ’ƒ', label: 'è·³èˆ' }, { id: 'fighting', icon: 'âš”ï¸', label: 'æˆ°é¬¥' },
                { id: 'escaping', icon: 'ğŸšª', label: 'é€ƒè„«' }, { id: 'jumping', icon: 'ğŸ¦˜', label: 'è·³èº' }, { id: 'hiding', icon: 'ğŸ™ˆ', label: 'èº²è—' },
                { id: 'searching', icon: 'ğŸ”', label: 'å°‹æ‰¾' }, { id: 'walking', icon: 'ğŸš¶', label: 'è¡Œèµ°' }, { id: 'floating', icon: 'ğŸˆ', label: 'æ¼‚æµ®' },
                { id: 'singing', icon: 'ğŸ¤', label: 'å”±æ­Œ' }, { id: 'crying', icon: 'ğŸ˜­', label: 'å“­æ³£' }, { id: 'laughing', icon: 'ğŸ˜‚', label: 'å¤§ç¬‘' },
                { id: 'stealing', icon: 'ğŸ¦¹', label: 'å·ç«Š' }, { id: 'killing', icon: 'ğŸ—¡ï¸', label: 'æ®ºäºº' }
            ]},
            { id: 'place', title: 'ğŸ  å ´æ™¯', types: [
                { id: 'ocean', icon: 'ğŸŒŠ', label: 'æµ·æ´‹' }, { id: 'forest', icon: 'ğŸŒ²', label: 'æ£®æ—' }, { id: 'mountain', icon: 'â›°ï¸', label: 'å±±è„ˆ' },
                { id: 'sky', icon: 'â˜ï¸', label: 'å¤©ç©º' }, { id: 'house', icon: 'ğŸ ', label: 'æˆ¿å±‹' }, { id: 'school', icon: 'ğŸ«', label: 'å­¸æ ¡' },
                { id: 'office', icon: 'ğŸ¢', label: 'è¾¦å…¬å®¤' }, { id: 'hospital', icon: 'ğŸ¥', label: 'é†«é™¢' }, { id: 'temple', icon: 'â›©ï¸', label: 'å¯ºå»Ÿ' },
                { id: 'castle', icon: 'ğŸ°', label: 'åŸå ¡' }, { id: 'maze', icon: 'ğŸŒ€', label: 'è¿·å®®' }, { id: 'elevator', icon: 'ğŸ›—', label: 'é›»æ¢¯' },
                { id: 'tunnel', icon: 'ğŸš‡', label: 'éš§é“' }, { id: 'bridge', icon: 'ğŸŒ‰', label: 'æ©‹æ¨‘' }, { id: 'cave', icon: 'ğŸ•³ï¸', label: 'æ´ç©´' },
                { id: 'beach', icon: 'ğŸ–ï¸', label: 'æµ·ç˜' }, { id: 'desert', icon: 'ğŸœï¸', label: 'æ²™æ¼ ' }, { id: 'city', icon: 'ğŸŒƒ', label: 'åŸå¸‚' },
                { id: 'village', icon: 'ğŸ˜ï¸', label: 'æ‘èŠ' }, { id: 'garden', icon: 'ğŸŒ·', label: 'èŠ±åœ’' }, { id: 'library', icon: 'ğŸ“š', label: 'åœ–æ›¸é¤¨' },
                { id: 'prison', icon: 'ğŸ”’', label: 'ç›£ç„' }, { id: 'airport', icon: 'âœˆï¸', label: 'æ©Ÿå ´' }, { id: 'station', icon: 'ğŸš‰', label: 'è»Šç«™' },
                { id: 'church', icon: 'â›ª', label: 'æ•™å ‚' }, { id: 'graveyard', icon: 'ğŸª¦', label: 'å¢“åœ°' }, { id: 'playground', icon: 'ğŸ ', label: 'éŠæ¨‚å ´' },
                { id: 'underwater', icon: 'ğŸ¤¿', label: 'æ°´åº•' }, { id: 'space', icon: 'ğŸš€', label: 'å¤ªç©º' }, { id: 'unknown', icon: 'â“', label: 'é™Œç”Ÿåœ°' }
            ]},
            { id: 'people', title: 'ğŸ‘¥ äººç‰©', types: [
                { id: 'family', icon: 'ğŸ‘¨â€ğŸ‘©â€ğŸ‘§', label: 'å®¶äºº' }, { id: 'father', icon: 'ğŸ‘¨', label: 'çˆ¶è¦ª' }, { id: 'mother', icon: 'ğŸ‘©', label: 'æ¯è¦ª' },
                { id: 'sibling', icon: 'ğŸ‘«', label: 'æ‰‹è¶³' }, { id: 'grandparent', icon: 'ğŸ‘´', label: 'ç¥–çˆ¶æ¯' }, { id: 'friend', icon: 'ğŸ¤', label: 'æœ‹å‹' },
                { id: 'lover', icon: 'ğŸ’‘', label: 'æˆ€äºº' }, { id: 'ex', icon: 'ğŸ’”', label: 'å‰ä»»' }, { id: 'crush', icon: 'ğŸ˜', label: 'æš—æˆ€' },
                { id: 'stranger', icon: 'ğŸ­', label: 'é™Œç”Ÿäºº' }, { id: 'deceased', icon: 'ğŸ‘¼', label: 'å·²æ•…è€…' }, { id: 'celebrity', icon: 'â­', label: 'åäºº' },
                { id: 'teacher', icon: 'ğŸ‘¨â€ğŸ«', label: 'è€å¸«' }, { id: 'student', icon: 'ğŸ‘¨â€ğŸ“', label: 'å­¸ç”Ÿ' }, { id: 'baby', icon: 'ğŸ‘¶', label: 'å¬°å…’' },
                { id: 'child', icon: 'ğŸ§’', label: 'å°å­©' }, { id: 'elderly', icon: 'ğŸ§“', label: 'è€äºº' }, { id: 'enemy', icon: 'ğŸ˜ ', label: 'æ•µäºº' },
                { id: 'self', icon: 'ğŸª', label: 'åˆ†èº«' }, { id: 'god', icon: 'ğŸ‘‘', label: 'ç¥æ˜' }, { id: 'boss', icon: 'ğŸ‘”', label: 'è€é—†' },
                { id: 'doctor', icon: 'ğŸ‘¨â€âš•ï¸', label: 'é†«ç”Ÿ' }, { id: 'police', icon: 'ğŸ‘®', label: 'è­¦å¯Ÿ' }, { id: 'soldier', icon: 'ğŸ’‚', label: 'è»äºº' },
                { id: 'crowd', icon: 'ğŸ‘¥', label: 'äººç¾¤' }, { id: 'twin', icon: 'ğŸ‘¯', label: 'é›™èƒèƒ' }
            ]},
            { id: 'animal', title: 'ğŸ¾ å‹•ç‰©', types: [
                { id: 'snake', icon: 'ğŸ', label: 'è›‡' }, { id: 'dog', icon: 'ğŸ•', label: 'ç‹—' }, { id: 'cat', icon: 'ğŸˆ', label: 'è²“' },
                { id: 'bird', icon: 'ğŸ¦', label: 'é³¥' }, { id: 'fish', icon: 'ğŸŸ', label: 'é­š' }, { id: 'dragon', icon: 'ğŸ‰', label: 'é¾' },
                { id: 'tiger', icon: 'ğŸ…', label: 'è™' }, { id: 'lion', icon: 'ğŸ¦', label: 'ç…' }, { id: 'horse', icon: 'ğŸ´', label: 'é¦¬' },
                { id: 'wolf', icon: 'ğŸº', label: 'ç‹¼' }, { id: 'bear', icon: 'ğŸ»', label: 'ç†Š' }, { id: 'elephant', icon: 'ğŸ˜', label: 'è±¡' },
                { id: 'spider', icon: 'ğŸ•·ï¸', label: 'èœ˜è››' }, { id: 'butterfly', icon: 'ğŸ¦‹', label: 'è´è¶' }, { id: 'bee', icon: 'ğŸ', label: 'èœœèœ‚' },
                { id: 'ant', icon: 'ğŸœ', label: 'èèŸ»' }, { id: 'rat', icon: 'ğŸ€', label: 'é¼ ' }, { id: 'rabbit', icon: 'ğŸ‡', label: 'å…”' },
                { id: 'turtle', icon: 'ğŸ¢', label: 'é¾œ' }, { id: 'frog', icon: 'ğŸ¸', label: 'é’è›™' }, { id: 'whale', icon: 'ğŸ‹', label: 'é¯¨é­š' },
                { id: 'shark', icon: 'ğŸ¦ˆ', label: 'é¯Šé­š' }, { id: 'dolphin', icon: 'ğŸ¬', label: 'æµ·è±š' }, { id: 'eagle', icon: 'ğŸ¦…', label: 'è€é·¹' },
                { id: 'owl', icon: 'ğŸ¦‰', label: 'è²“é ­é·¹' }, { id: 'crow', icon: 'ğŸ¦â€â¬›', label: 'çƒé´‰' }, { id: 'phoenix', icon: 'ğŸ”¥', label: 'é³³å‡°' },
                { id: 'unicorn', icon: 'ğŸ¦„', label: 'ç¨è§’ç¸' }, { id: 'monster', icon: 'ğŸ‘¹', label: 'æ€ªç‰©' }, { id: 'dinosaur', icon: 'ğŸ¦–', label: 'æé¾' }
            ]},
            { id: 'body', title: 'ğŸ¦´ èº«é«”', types: [
                { id: 'teeth', icon: 'ğŸ¦·', label: 'æ‰ç‰™' }, { id: 'hair', icon: 'ğŸ’‡', label: 'é ­é«®' }, { id: 'eyes', icon: 'ğŸ‘ï¸', label: 'çœ¼ç›' },
                { id: 'hands', icon: 'ğŸ¤²', label: 'æ‰‹' }, { id: 'feet', icon: 'ğŸ¦¶', label: 'è…³' }, { id: 'heart', icon: 'â¤ï¸', label: 'å¿ƒè‡Ÿ' },
                { id: 'blood', icon: 'ğŸ©¸', label: 'è¡€' }, { id: 'bones', icon: 'ğŸ¦´', label: 'éª¨é ­' }, { id: 'skin', icon: 'ğŸ«³', label: 'çš®è†š' },
                { id: 'naked', icon: 'ğŸ˜³', label: 'è£¸éœ²' }, { id: 'sick', icon: 'ğŸ¤’', label: 'ç”Ÿç—…' }, { id: 'injured', icon: 'ğŸ©¹', label: 'å—å‚·' },
                { id: 'pregnant', icon: 'ğŸ¤°', label: 'æ‡·å­•' }, { id: 'birth', icon: 'ğŸ‘¶', label: 'ç”Ÿç”¢' }, { id: 'death', icon: 'ğŸ’€', label: 'æ­»äº¡' },
                { id: 'paralysis', icon: 'ğŸ˜°', label: 'é¬¼å£“åºŠ' }, { id: 'blind', icon: 'ğŸ¦¯', label: 'å¤±æ˜' }, { id: 'deaf', icon: 'ğŸ¦»', label: 'å¤±è°' },
                { id: 'mute', icon: 'ğŸ¤', label: 'å¤±è²' }, { id: 'aging', icon: 'ğŸ‘µ', label: 'è®Šè€' }
            ]},
            { id: 'emotion', title: 'ğŸ’­ æƒ…ç·’', types: [
                { id: 'happy', icon: 'ğŸ˜Š', label: 'å¿«æ¨‚' }, { id: 'sad', icon: 'ğŸ˜¢', label: 'æ‚²å‚·' }, { id: 'angry', icon: 'ğŸ˜ ', label: 'æ†¤æ€’' },
                { id: 'fear', icon: 'ğŸ˜¨', label: 'ææ‡¼' }, { id: 'anxiety', icon: 'ğŸ˜°', label: 'ç„¦æ…®' }, { id: 'confused', icon: 'ğŸ˜•', label: 'å›°æƒ‘' },
                { id: 'lonely', icon: 'ğŸ˜”', label: 'å­¤ç¨' }, { id: 'peaceful', icon: 'ğŸ˜Œ', label: 'å¹³éœ' }, { id: 'excited', icon: 'ğŸ¤©', label: 'èˆˆå¥®' },
                { id: 'embarrassed', icon: 'ğŸ˜³', label: 'å°·å°¬' }, { id: 'jealous', icon: 'ğŸ˜’', label: 'å«‰å¦’' }, { id: 'guilty', icon: 'ğŸ˜”', label: 'æ„§ç–š' },
                { id: 'proud', icon: 'ğŸ˜¤', label: 'é©•å‚²' }, { id: 'nostalgic', icon: 'ğŸ¥¹', label: 'æ‡·èˆŠ' }, { id: 'hopeful', icon: 'ğŸ¤', label: 'æœŸå¾…' }
            ]},
            { id: 'life', title: 'ğŸ’¼ ç”Ÿæ´»', types: [
                { id: 'exam', icon: 'ğŸ“', label: 'è€ƒè©¦' }, { id: 'late', icon: 'â°', label: 'é²åˆ°' }, { id: 'lost', icon: 'ğŸ§­', label: 'è¿·è·¯' },
                { id: 'trapped', icon: 'ğŸ”’', label: 'å›°ä½' }, { id: 'wedding', icon: 'ğŸ’’', label: 'å©šç¦®' }, { id: 'divorce', icon: 'ğŸ’”', label: 'é›¢å©š' },
                { id: 'funeral', icon: 'âš°ï¸', label: 'è‘¬ç¦®' }, { id: 'party', icon: 'ğŸ‰', label: 'æ´¾å°' }, { id: 'travel', icon: 'ğŸ§³', label: 'æ—…è¡Œ' },
                { id: 'moving', icon: 'ğŸ“¦', label: 'æ¬å®¶' }, { id: 'interview', icon: 'ğŸ’¼', label: 'é¢è©¦' }, { id: 'fired', icon: 'ğŸ“¤', label: 'è¢«é–‹é™¤' },
                { id: 'promoted', icon: 'ğŸ“ˆ', label: 'å‡é·' }, { id: 'graduation', icon: 'ğŸ“', label: 'ç•¢æ¥­' }, { id: 'performance', icon: 'ğŸ¤', label: 'è¡¨æ¼”' },
                { id: 'meeting', icon: 'ğŸ¤', label: 'æœƒè­°' }, { id: 'argument', icon: 'ğŸ—£ï¸', label: 'çˆ­åµ' }, { id: 'confession', icon: 'ğŸ’Œ', label: 'å‘Šç™½' }
            ]},
            { id: 'object', title: 'ğŸ“¦ ç‰©å“', types: [
                { id: 'money', icon: 'ğŸ’°', label: 'é‡‘éŒ¢' }, { id: 'gold', icon: 'ğŸ¥‡', label: 'é»ƒé‡‘' }, { id: 'gift', icon: 'ğŸ', label: 'ç¦®ç‰©' },
                { id: 'phone', icon: 'ğŸ“±', label: 'é›»è©±' }, { id: 'computer', icon: 'ğŸ’»', label: 'é›»è…¦' }, { id: 'mirror', icon: 'ğŸª', label: 'é¡å­' },
                { id: 'door', icon: 'ğŸšª', label: 'é–€' }, { id: 'window', icon: 'ğŸªŸ', label: 'çª—æˆ¶' }, { id: 'key', icon: 'ğŸ”‘', label: 'é‘°åŒ™' },
                { id: 'lock', icon: 'ğŸ”', label: 'é–' }, { id: 'book', icon: 'ğŸ“–', label: 'æ›¸' }, { id: 'letter', icon: 'âœ‰ï¸', label: 'ä¿¡' },
                { id: 'photo', icon: 'ğŸ“·', label: 'ç…§ç‰‡' }, { id: 'ring', icon: 'ğŸ’', label: 'æˆ’æŒ‡' }, { id: 'necklace', icon: 'ğŸ“¿', label: 'é …éŠ' },
                { id: 'clock', icon: 'ğŸ•', label: 'æ™‚é˜' }, { id: 'candle', icon: 'ğŸ•¯ï¸', label: 'è Ÿç‡­' }, { id: 'sword', icon: 'ğŸ—¡ï¸', label: 'åŠ' },
                { id: 'gun', icon: 'ğŸ”«', label: 'æ§' }, { id: 'rope', icon: 'ğŸª¢', label: 'ç¹©å­' }
            ]},
            { id: 'vehicle', title: 'ğŸš— äº¤é€š', types: [
                { id: 'car', icon: 'ğŸš—', label: 'æ±½è»Š' }, { id: 'bus', icon: 'ğŸšŒ', label: 'å…¬è»Š' }, { id: 'train', icon: 'ğŸš†', label: 'ç«è»Š' },
                { id: 'plane', icon: 'âœˆï¸', label: 'é£›æ©Ÿ' }, { id: 'boat', icon: 'â›µ', label: 'èˆ¹' }, { id: 'bike', icon: 'ğŸš²', label: 'è…³è¸è»Š' },
                { id: 'motorcycle', icon: 'ğŸï¸', label: 'æ©Ÿè»Š' }, { id: 'helicopter', icon: 'ğŸš', label: 'ç›´å‡æ©Ÿ' }, { id: 'rocket', icon: 'ğŸš€', label: 'ç«ç®­' },
                { id: 'submarine', icon: 'ğŸ›¥ï¸', label: 'æ½›è‰‡' }, { id: 'taxi', icon: 'ğŸš•', label: 'è¨ˆç¨‹è»Š' }, { id: 'ambulance', icon: 'ğŸš‘', label: 'æ•‘è­·è»Š' }
            ]},
            { id: 'nature', title: 'ğŸŒ¿ è‡ªç„¶', types: [
                { id: 'rain', icon: 'ğŸŒ§ï¸', label: 'ä¸‹é›¨' }, { id: 'snow', icon: 'â„ï¸', label: 'ä¸‹é›ª' }, { id: 'storm', icon: 'â›ˆï¸', label: 'æš´é¢¨é›¨' },
                { id: 'thunder', icon: 'âš¡', label: 'é›·é›»' }, { id: 'flood', icon: 'ğŸŒŠ', label: 'æ´ªæ°´' }, { id: 'earthquake', icon: 'ğŸŒ‹', label: 'åœ°éœ‡' },
                { id: 'volcano', icon: 'ğŸŒ‹', label: 'ç«å±±' }, { id: 'tornado', icon: 'ğŸŒªï¸', label: 'é¾æ²é¢¨' }, { id: 'tsunami', icon: 'ğŸŒŠ', label: 'æµ·å˜¯' },
                { id: 'fire', icon: 'ğŸ”¥', label: 'ç«ç½' }, { id: 'sun', icon: 'â˜€ï¸', label: 'å¤ªé™½' }, { id: 'moon', icon: 'ğŸŒ™', label: 'æœˆäº®' },
                { id: 'stars', icon: 'â­', label: 'æ˜Ÿæ˜Ÿ' }, { id: 'rainbow', icon: 'ğŸŒˆ', label: 'å½©è™¹' }, { id: 'aurora', icon: 'ğŸŒŒ', label: 'æ¥µå…‰' },
                { id: 'flower', icon: 'ğŸŒ¸', label: 'èŠ±' }, { id: 'tree', icon: 'ğŸŒ³', label: 'æ¨¹' }, { id: 'grass', icon: 'ğŸŒ¿', label: 'è‰' },
                { id: 'river', icon: 'ğŸï¸', label: 'æ²³æµ' }, { id: 'waterfall', icon: 'ğŸ’§', label: 'ç€‘å¸ƒ' }
            ]},
            { id: 'food', title: 'ğŸœ é£Ÿç‰©', types: [
                { id: 'rice', icon: 'ğŸš', label: 'ç±³é£¯' }, { id: 'noodle', icon: 'ğŸœ', label: 'éºµ' }, { id: 'bread', icon: 'ğŸ', label: 'éºµåŒ…' },
                { id: 'meat', icon: 'ğŸ¥©', label: 'è‚‰' }, { id: 'fish_food', icon: 'ğŸŸ', label: 'é­šè‚‰' }, { id: 'vegetable', icon: 'ğŸ¥¬', label: 'è”¬èœ' },
                { id: 'fruit', icon: 'ğŸ', label: 'æ°´æœ' }, { id: 'apple', icon: 'ğŸ', label: 'è˜‹æœ' }, { id: 'banana', icon: 'ğŸŒ', label: 'é¦™è•‰' },
                { id: 'cake', icon: 'ğŸ‚', label: 'è›‹ç³•' }, { id: 'candy', icon: 'ğŸ¬', label: 'ç³–æœ' }, { id: 'chocolate', icon: 'ğŸ«', label: 'å·§å…‹åŠ›' },
                { id: 'icecream', icon: 'ğŸ¦', label: 'å†°æ·‡æ·‹' }, { id: 'coffee', icon: 'â˜•', label: 'å’–å•¡' }, { id: 'tea', icon: 'ğŸµ', label: 'èŒ¶' },
                { id: 'wine', icon: 'ğŸ·', label: 'é…’' }, { id: 'water_drink', icon: 'ğŸ’§', label: 'æ°´' }, { id: 'poison', icon: 'â˜ ï¸', label: 'æ¯’è—¥' }
            ]},
            { id: 'job', title: 'ğŸ‘” è·æ¥­', types: [
                { id: 'teacher_job', icon: 'ğŸ‘¨â€ğŸ«', label: 'æ•™å¸«' }, { id: 'doctor_job', icon: 'ğŸ‘¨â€âš•ï¸', label: 'é†«ç”Ÿ' }, { id: 'nurse', icon: 'ğŸ‘©â€âš•ï¸', label: 'è­·å£«' },
                { id: 'lawyer', icon: 'âš–ï¸', label: 'å¾‹å¸«' }, { id: 'judge', icon: 'ğŸ‘¨â€âš–ï¸', label: 'æ³•å®˜' }, { id: 'police_job', icon: 'ğŸ‘®', label: 'è­¦å¯Ÿ' },
                { id: 'firefighter', icon: 'ğŸ‘¨â€ğŸš’', label: 'æ¶ˆé˜²å“¡' }, { id: 'chef', icon: 'ğŸ‘¨â€ğŸ³', label: 'å»šå¸«' }, { id: 'farmer', icon: 'ğŸ‘¨â€ğŸŒ¾', label: 'è¾²å¤«' },
                { id: 'pilot', icon: 'ğŸ‘¨â€âœˆï¸', label: 'æ©Ÿå¸«' }, { id: 'astronaut', icon: 'ğŸ‘¨â€ğŸš€', label: 'å¤ªç©ºäºº' }, { id: 'scientist', icon: 'ğŸ‘¨â€ğŸ”¬', label: 'ç§‘å­¸å®¶' },
                { id: 'artist', icon: 'ğŸ‘¨â€ğŸ¨', label: 'è—è¡“å®¶' }, { id: 'musician', icon: 'ğŸ‘¨â€ğŸ¤', label: 'éŸ³æ¨‚å®¶' }, { id: 'actor', icon: 'ğŸ­', label: 'æ¼”å“¡' },
                { id: 'king', icon: 'ğŸ¤´', label: 'åœ‹ç‹' }, { id: 'queen', icon: 'ğŸ‘¸', label: 'çš‡å' }, { id: 'monk', icon: 'ğŸ§˜', label: 'åƒ§ä¾¶' }
            ]},
            { id: 'sport', title: 'âš½ é‹å‹•', types: [
                { id: 'soccer', icon: 'âš½', label: 'è¶³çƒ' }, { id: 'basketball', icon: 'ğŸ€', label: 'ç±ƒçƒ' }, { id: 'baseball', icon: 'âš¾', label: 'æ£’çƒ' },
                { id: 'tennis', icon: 'ğŸ¾', label: 'ç¶²çƒ' }, { id: 'golf', icon: 'â›³', label: 'é«˜çˆ¾å¤«' }, { id: 'swim_sport', icon: 'ğŸŠ', label: 'æ¸¸æ³³' },
                { id: 'run_sport', icon: 'ğŸƒ', label: 'è·‘æ­¥' }, { id: 'boxing', icon: 'ğŸ¥Š', label: 'æ‹³æ“Š' }, { id: 'martial', icon: 'ğŸ¥‹', label: 'æ­¦è¡“' },
                { id: 'ski', icon: 'â›·ï¸', label: 'æ»‘é›ª' }, { id: 'surf', icon: 'ğŸ„', label: 'è¡æµª' }, { id: 'climb_sport', icon: 'ğŸ§—', label: 'æ”€å²©' },
                { id: 'yoga', icon: 'ğŸ§˜', label: 'ç‘œä¼½' }, { id: 'gym', icon: 'ğŸ‹ï¸', label: 'å¥èº«' }, { id: 'race', icon: 'ğŸ', label: 'è³½è»Š' }
            ]},
            { id: 'music', title: 'ğŸµ éŸ³æ¨‚', types: [
                { id: 'piano', icon: 'ğŸ¹', label: 'é‹¼ç´' }, { id: 'guitar', icon: 'ğŸ¸', label: 'å‰ä»–' }, { id: 'violin', icon: 'ğŸ»', label: 'å°æç´' },
                { id: 'drums', icon: 'ğŸ¥', label: 'é¼“' }, { id: 'flute', icon: 'ğŸªˆ', label: 'ç¬›å­' }, { id: 'singing_music', icon: 'ğŸ¤', label: 'æ­Œå”±' },
                { id: 'concert', icon: 'ğŸª', label: 'æ¼”å”±æœƒ' }, { id: 'orchestra', icon: 'ğŸ¼', label: 'äº¤éŸ¿æ¨‚' }, { id: 'dance_music', icon: 'ğŸ’ƒ', label: 'èˆè¹ˆ' }, { id: 'opera', icon: 'ğŸ­', label: 'æ­ŒåŠ‡' }
            ]},
            { id: 'fantasy', title: 'ğŸŒŒ å¥‡å¹»', types: [
                { id: 'timetravel', icon: 'â³', label: 'ç©¿è¶Š' }, { id: 'superpower', icon: 'âš¡', label: 'è¶…èƒ½åŠ›' }, { id: 'transform', icon: 'ğŸ¦¸', label: 'è®Šèº«' },
                { id: 'invisible', icon: 'ğŸ‘»', label: 'éš±å½¢' }, { id: 'telepathy', icon: 'ğŸ§ ', label: 'è®€å¿ƒ' }, { id: 'teleport', icon: 'ğŸŒ€', label: 'ç¬ç§»' },
                { id: 'parallel', icon: 'ğŸŒŒ', label: 'å¹³è¡Œä¸–ç•Œ' }, { id: 'apocalypse', icon: 'ğŸ’¥', label: 'æœ«æ—¥' }, { id: 'war', icon: 'ğŸ’£', label: 'æˆ°çˆ­' },
                { id: 'alien', icon: 'ğŸ‘½', label: 'å¤–æ˜Ÿäºº' }, { id: 'ufo', icon: 'ğŸ›¸', label: 'UFO' }, { id: 'ghost', icon: 'ğŸ‘»', label: 'é¬¼é­‚' },
                { id: 'zombie', icon: 'ğŸ§Ÿ', label: 'æ®­å±' }, { id: 'vampire', icon: 'ğŸ§›', label: 'å¸è¡€é¬¼' }, { id: 'werewolf', icon: 'ğŸº', label: 'ç‹¼äºº' },
                { id: 'witch', icon: 'ğŸ§™', label: 'å·«å¸«' }, { id: 'magic', icon: 'ğŸª„', label: 'é­”æ³•' }, { id: 'fairy', icon: 'ğŸ§š', label: 'ä»™å¥³' },
                { id: 'mermaid', icon: 'ğŸ§œ', label: 'ç¾äººé­š' }, { id: 'angel', icon: 'ğŸ‘¼', label: 'å¤©ä½¿' }, { id: 'demon', icon: 'ğŸ˜ˆ', label: 'æƒ¡é­”' },
                { id: 'giant', icon: 'ğŸ¦£', label: 'å·¨äºº' }, { id: 'dwarf', icon: 'ğŸ§', label: 'çŸ®äºº' }, { id: 'elf', icon: 'ğŸ§', label: 'ç²¾éˆ' }
            ]},
            { id: 'color', title: 'ğŸ¨ é¡è‰²', types: [
                { id: 'red', icon: 'ğŸ”´', label: 'ç´…è‰²' }, { id: 'orange_c', icon: 'ğŸŸ ', label: 'æ©™è‰²' }, { id: 'yellow', icon: 'ğŸŸ¡', label: 'é»ƒè‰²' },
                { id: 'green', icon: 'ğŸŸ¢', label: 'ç¶ è‰²' }, { id: 'blue', icon: 'ğŸ”µ', label: 'è—è‰²' }, { id: 'purple', icon: 'ğŸŸ£', label: 'ç´«è‰²' },
                { id: 'pink', icon: 'ğŸ©·', label: 'ç²‰è‰²' }, { id: 'white', icon: 'âšª', label: 'ç™½è‰²' }, { id: 'black', icon: 'âš«', label: 'é»‘è‰²' },
                { id: 'gold_c', icon: 'ğŸ¥‡', label: 'é‡‘è‰²' }, { id: 'silver', icon: 'ğŸ¥ˆ', label: 'éŠ€è‰²' }, { id: 'bw', icon: 'ğŸï¸', label: 'é»‘ç™½å¤¢' }
            ]},
            { id: 'time', title: 'â° æ™‚é–“', types: [
                { id: 'childhood', icon: 'ğŸ’’', label: 'ç«¥å¹´' }, { id: 'youth', icon: 'ğŸ‘¦', label: 'é’å¹´' }, { id: 'past', icon: 'â®ï¸', label: 'éå»' },
                { id: 'future', icon: 'â­ï¸', label: 'æœªä¾†' }, { id: 'ancient', icon: 'ğŸ›ï¸', label: 'å¤ä»£' }, { id: 'medieval', icon: 'ğŸ°', label: 'ä¸­ä¸–ç´€' },
                { id: 'modern', icon: 'ğŸ™ï¸', label: 'ç¾ä»£' }, { id: 'scifi', icon: 'ğŸš€', label: 'ç§‘å¹»' }, { id: 'night', icon: 'ğŸŒ™', label: 'å¤œæ™š' },
                { id: 'dawn', icon: 'ğŸŒ…', label: 'é»æ˜' }, { id: 'dusk', icon: 'ğŸŒ‡', label: 'é»ƒæ˜' }
            ]},
            { id: 'spiritual', title: 'ğŸ™ éˆæ€§', types: [
                { id: 'heaven', icon: 'â˜ï¸', label: 'å¤©å ‚' }, { id: 'hell', icon: 'ğŸ”¥', label: 'åœ°ç„' }, { id: 'purgatory', icon: 'âš–ï¸', label: 'ç…‰ç„' },
                { id: 'reincarnation', icon: 'â™»ï¸', label: 'è¼ªè¿´' }, { id: 'karma', icon: 'â˜¯ï¸', label: 'å› æœ' }, { id: 'meditation', icon: 'ğŸ§˜', label: 'å†¥æƒ³' },
                { id: 'enlightenment', icon: 'ğŸ’¡', label: 'é–‹æ‚Ÿ' }, { id: 'blessing', icon: 'ğŸ™', label: 'ç¥ç¦' }, { id: 'curse', icon: 'ğŸ”®', label: 'è©›å’’' },
                { id: 'ritual', icon: 'ğŸ•¯ï¸', label: 'å„€å¼' }, { id: 'prayer', icon: 'ğŸ™', label: 'ç¥ˆç¦±' }, { id: 'prophecy', icon: 'ğŸ“œ', label: 'é è¨€' }
            ]},
            { id: 'number', title: 'ğŸ”¢ æ•¸å­—', types: [
                { id: 'n0', icon: '0ï¸âƒ£', label: '0' }, { id: 'n1', icon: '1ï¸âƒ£', label: '1' }, { id: 'n2', icon: '2ï¸âƒ£', label: '2' },
                { id: 'n3', icon: '3ï¸âƒ£', label: '3' }, { id: 'n4', icon: '4ï¸âƒ£', label: '4' }, { id: 'n5', icon: '5ï¸âƒ£', label: '5' },
                { id: 'n6', icon: '6ï¸âƒ£', label: '6' }, { id: 'n7', icon: '7ï¸âƒ£', label: '7' }, { id: 'n8', icon: '8ï¸âƒ£', label: '8' },
                { id: 'n9', icon: '9ï¸âƒ£', label: '9' }, { id: 'lottery', icon: 'ğŸ°', label: 'æ¨‚é€' }, { id: 'lucky_n', icon: 'ğŸ€', label: 'å¹¸é‹æ•¸' }
            ]},
            { id: 'season', title: 'ğŸ‚ å­£ç¯€', types: [
                { id: 'spring', icon: 'ğŸŒ¸', label: 'æ˜¥å¤©' }, { id: 'summer', icon: 'â˜€ï¸', label: 'å¤å¤©' }, { id: 'autumn', icon: 'ğŸ‚', label: 'ç§‹å¤©' },
                { id: 'winter', icon: 'â„ï¸', label: 'å†¬å¤©' }, { id: 'newyear', icon: 'ğŸŠ', label: 'æ–°å¹´' }, { id: 'christmas', icon: 'ğŸ„', label: 'è–èª•' },
                { id: 'halloween', icon: 'ğŸƒ', label: 'è¬è–ç¯€' }, { id: 'valentine', icon: 'ğŸ’•', label: 'æƒ…äººç¯€' }, { id: 'birthday', icon: 'ğŸ‚', label: 'ç”Ÿæ—¥' }
            ]}
        ];
        const dreamTypeLabels = {}; let totalTypes = 0;
        dreamCategories.forEach(c => c.types.forEach(t => { dreamTypeLabels[t.id] = t.label + 'å¤¢'; totalTypes++; }));
        let selectedDreamType = 'general', selectedCategory = 'all', currentInputMode = 'text', dreamResult = null, dreamHistory = [], isPaused = false, isPlaying = false, isStopping = false, fileContent = '', imageBase64 = '', currentAudio = null, currentUtterance = null, cachedSpeechText = '', cachedAudioBlob = null, cachedTTSMode = '';
        const settings = { groqApiKey: '', gasUrl: '', ttsMode: 'web', geminiApiKey: '', geminiVoice: 'Aoede', elevenLabsApiKey: '', elevenLabsVoice: 'pFZP5JQG7iQjIQuC4Bku', elevenLabsCustomId: '', aiModel: 'llama4-scout' };
        const geminiVoiceNames = { 'Aoede': 'ğŸ‘© Aoede è‡ªç„¶æ¸…æ–°', 'Kore': 'ğŸ‘© Kore å …å®šè‡ªä¿¡', 'Leda': 'ğŸ‘© Leda å¹´è¼•æ´»åŠ›', 'Zephyr': 'ğŸ‘© Zephyr æ˜äº®æ„‰å¿«', 'Charon': 'ğŸ‘¨ Charon å°ˆæ¥­æ¸…æ™°', 'Fenrir': 'ğŸ‘¨ Fenrir èˆˆå¥®æ´»åŠ›', 'Orus': 'ğŸ‘¨ Orus å …å®šæœæ–·', 'Puck': 'ğŸ‘¨ Puck æ´»æ½‘è¼•å¿«' };
        const elevenLabsVoiceNames = { 'pFZP5JQG7iQjIQuC4Bku': 'ğŸ‘© Lily æº«æŸ”å¥³è²', 'EXAVITQu4vr4xnSDxMaL': 'ğŸ‘© Sarah æŸ”å’Œæ–°è', '21m00Tcm4TlvDq8ikWAM': 'ğŸ‘© Rachel ç¾å¼å¥³è²', 'AZnzlk1XvdvUeBnXmlld': 'ğŸ‘© Domi æ´»åŠ›å¥³è²', 'MF3mGyEYCl7XYWbV9V6O': 'ğŸ‘© Elli å¹´è¼•å¥³è²', 'TxGEqnHWrfWFTfGW9XjX': 'ğŸ‘¨ Josh æ·±æ²‰ç”·è²', 'VR6AewLTigWG4xSOukaG': 'ğŸ‘¨ Arnold æ¸¾åšç”·è²', 'pNInz6obpgDQGcFmaJgB': 'ğŸ‘¨ Adam å°ˆæ¥­ç”·è²', 'yoZ06aMxZJJ28mfd3POQ': 'ğŸ‘¨ Sam æ•˜äº‹ç”·è²', 'onwK4e9ZLuTAKqWW03F9': 'ğŸ‘¨ Daniel è‹±å¼ç”·è²' };
        const aiModelIds = { 'llama4-scout': 'meta-llama/llama-4-scout-17b-16e-instruct', 'llama4-maverick': 'meta-llama/llama-4-maverick-17b-128e-instruct', 'gemini-2.0-flash': 'gemini-2.0-flash', 'gemini-2.5-flash': 'gemini-2.5-flash', 'gemini-2.5-pro': 'gemini-2.5-pro', 'gemini-3.0-pro': 'gemini-3-pro-preview' };
        const paidModels = ['gemini-2.5-pro', 'gemini-3.0-pro'];
        const ttsModeNames = { web: 'Web', gemini: 'Gemini', elevenlabs: 'ElevenLabs' };
        window.onload = function() {
            // é é¢éš±è—æ™‚åœæ­¢èªéŸ³
            document.addEventListener('visibilitychange', function() {
                if (document.hidden) stopSpeech();
            });
            // æ‰‹æ©Ÿè¿”å›éµåœæ­¢èªéŸ³
            window.addEventListener('pagehide', stopSpeech);
            window.addEventListener('beforeunload', stopSpeech);
            for(let i=0;i<25;i++){const p=document.createElement('div');p.className='particle';p.style.left=Math.random()*100+'%';p.style.top=Math.random()*100+'%';p.style.animationDelay=Math.random()*3+'s';p.style.background=Math.random()>0.5?'var(--neon-cyan)':'var(--neon-pink)';document.getElementById('particles').appendChild(p);}
            let h='<div class="category-tab active" onclick="filterByCategory(\'all\')">å…¨éƒ¨</div>';
            dreamCategories.forEach(c=>h+=`<div class="category-tab" onclick="filterByCategory('${c.id}')">${c.title}</div>`);
            document.getElementById('categoryTabs').innerHTML=h;
            document.getElementById('dreamTypesContainer').innerHTML=dreamCategories.map(c=>`<div class="dream-category" data-category="${c.id}"><div class="dream-category-title">${c.title}</div><div class="dream-types">${c.types.map(t=>`<div class="dream-type ${t.id==='general'?'selected':''}" data-type="${t.id}" data-label="${t.label}" onclick="selectDreamType(this)"><div class="icon">${t.icon}</div><div class="label">${t.label}</div></div>`).join('')}</div></div>`).join('');
            document.getElementById('dreamCountBadge').textContent=totalTypes+'ç¨®';
            loadSettings();loadHistory();checkApiStatus();
            setTimeout(()=>document.getElementById('splashScreen').classList.add('fade-out'),2500);
        };
        function filterByCategory(id){selectedCategory=id;document.querySelectorAll('.category-tab').forEach(t=>t.classList.remove('active'));event.currentTarget.classList.add('active');document.querySelectorAll('.dream-category').forEach(c=>{c.style.display=(id==='all'||c.dataset.category===id)?'block':'none';});}
        function filterDreamTypes(){const k=document.getElementById('dreamSearch').value.toLowerCase();document.querySelectorAll('.dream-type').forEach(e=>{e.classList.toggle('hidden',!e.dataset.label.toLowerCase().includes(k)&&k!=='');});}
        function showPage(p){stopSpeech();document.querySelectorAll('.page').forEach(x=>x.classList.remove('active'));document.querySelectorAll('.nav-item').forEach(x=>x.classList.remove('active'));document.getElementById('page-'+p).classList.add('active');event.currentTarget.classList.add('active');if(p==='history')renderHistory();if(p==='settings')updateTTSSettingsVisibility();}
        function switchInputTab(m){currentInputMode=m;document.querySelectorAll('.input-tab').forEach(t=>t.classList.remove('active'));document.querySelectorAll('.input-panel').forEach(p=>p.classList.remove('active'));event.currentTarget.classList.add('active');document.getElementById('panel-'+m).classList.add('active');checkCanAnalyze();}
        function updateCharCount(){document.getElementById('charCount').textContent=document.getElementById('dreamInput').value.length;checkCanAnalyze();}
        function handleFileUpload(e){const f=e.target.files[0];if(!f)return;const r=new FileReader();r.onload=x=>{fileContent=x.target.result;document.getElementById('fileName').textContent=f.name;document.getElementById('filePreview').classList.add('show');checkCanAnalyze();};r.readAsText(f);}
        function removeFile(){fileContent='';document.getElementById('fileInput').value='';document.getElementById('filePreview').classList.remove('show');checkCanAnalyze();}
        function handleImageUpload(e){const f=e.target.files[0];if(!f)return;const r=new FileReader();r.onload=x=>{imageBase64=x.target.result;document.getElementById('previewImg').src=imageBase64;document.getElementById('imagePreview').classList.add('show');checkCanAnalyze();};r.readAsDataURL(f);}
        function removeImage(){imageBase64='';document.getElementById('imageInput').value='';document.getElementById('imagePreview').classList.remove('show');checkCanAnalyze();}
        function clearInput(){stopSpeech();document.getElementById('dreamInput').value='';document.getElementById('charCount').textContent='0';fileContent='';imageBase64='';document.getElementById('fileInput').value='';document.getElementById('imageInput').value='';document.getElementById('filePreview').classList.remove('show');document.getElementById('imagePreview').classList.remove('show');checkCanAnalyze();showToast('ğŸ—‘ï¸ å·²æ¸…é™¤è¼¸å…¥');}
        function checkCanAnalyze(){let ok=false;if(currentInputMode==='text')ok=document.getElementById('dreamInput').value.length>=10;else if(currentInputMode==='file')ok=fileContent.length>=10;else if(currentInputMode==='image')ok=imageBase64.length>0;document.getElementById('analyzeBtn').disabled=!ok||!settings.groqApiKey;}
        function selectDreamType(e){document.querySelectorAll('.dream-type').forEach(t=>t.classList.remove('selected'));e.classList.add('selected');selectedDreamType=e.dataset.type;}
        async function analyzeDream(){stopSpeech();cachedSpeechText='';cachedAudioBlob=null;cachedTTSMode='';if(!settings.groqApiKey){showError('è«‹å…ˆè¨­å®šGroq API Key');return;}let d='';if(currentInputMode==='text')d=document.getElementById('dreamInput').value.trim();else if(currentInputMode==='file')d=fileContent;else d='[åœ–ç‰‡]';if(d.length<10&&currentInputMode!=='image'){showToast('âš ï¸ è‡³å°‘10å­—');return;}document.getElementById('analyzeBtn').style.display='none';document.getElementById('loadingArea').classList.add('show');document.getElementById('resultArea').classList.remove('show');document.getElementById('errorBox').classList.remove('show');try{let r;if(currentInputMode==='image'){document.getElementById('loadingText').textContent='è§£æåœ–ç‰‡...';r=await analyzeWithImage();}else{document.getElementById('loadingText').textContent='é€£çµæ½›æ„è­˜...';r=await callGroqAPI(d);}dreamResult=r;displayResult(r);saveDreamToHistory(d,r);document.getElementById('loadingArea').classList.remove('show');document.getElementById('resultArea').classList.add('show');}catch(e){document.getElementById('loadingArea').classList.remove('show');document.getElementById('analyzeBtn').style.display='block';showError('å¤±æ•—ï¼š'+e.message);}}
        async function callGroqAPI(t){const p=`ä½ æ˜¯å°ˆæ¥­è§£å¤¢å¤§å¸«ã€‚å¤¢å¢ƒé¡å‹ï¼š${dreamTypeLabels[selectedDreamType]||'ä¸€èˆ¬å¤¢å¢ƒ'}ã€‚å¤¢å¢ƒï¼š${t}ã€‚ç”¨ç¹é«”ä¸­æ–‡å›ç­”JSONï¼š{"title":"æ¨™é¡Œ","scores":{"positive":0-100,"psychology":0-100,"prophetic":0-100},"symbolMeaning":"è±¡å¾µ100å­—","psychoAnalysis":"å¿ƒç†100å­—","prediction":"å»ºè­°100å­—","lucky":{"color":"","number":"","time":"","charm":""}}`;const r=await fetch('https://api.groq.com/openai/v1/chat/completions',{method:'POST',headers:{'Content-Type':'application/json','Authorization':'Bearer '+settings.groqApiKey},body:JSON.stringify({model:'llama-3.3-70b-versatile',messages:[{role:'user',content:p}],temperature:0.8,max_tokens:1500})});if(!r.ok)throw new Error((await r.json()).error?.message||'APIéŒ¯èª¤');const d=await r.json();const m=d.choices[0].message.content.match(/\{[\s\S]*\}/);if(m)return JSON.parse(m[0]);throw new Error('è§£æå¤±æ•—');}
        async function analyzeWithImage(){const p=`ä½ æ˜¯å°ˆæ¥­è§£å¤¢å¤§å¸«ã€‚åˆ†æé€™å¼µåœ–ç‰‡ä½œç‚ºå¤¢å¢ƒã€‚å¤¢å¢ƒé¡å‹ï¼š${dreamTypeLabels[selectedDreamType]||'ä¸€èˆ¬å¤¢å¢ƒ'}ã€‚è«‹ç”¨ç¹é«”ä¸­æ–‡å›ç­”ï¼ŒJSONæ ¼å¼ï¼š{"title":"","scores":{"positive":0,"psychology":0,"prophetic":0},"symbolMeaning":"","psychoAnalysis":"","prediction":"","lucky":{"color":"","number":"","time":"","charm":""}}`;const isGemini=settings.aiModel.startsWith('gemini-');if(isGemini){if(!settings.geminiApiKey)throw new Error('è«‹å…ˆè¨­å®š Gemini API Key');const base64Data=imageBase64.replace(/^data:image\/\w+;base64,/,'');const mimeType=imageBase64.match(/^data:(image\/\w+);base64,/)?.[1]||'image/jpeg';const modelId=aiModelIds[settings.aiModel]||'gemini-2.5-flash';const r=await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${modelId}:generateContent?key=${settings.geminiApiKey}`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({contents:[{parts:[{inline_data:{mime_type:mimeType,data:base64Data}},{text:p}]}]})});if(!r.ok){const err=await r.json();throw new Error(err.error?.message||'Gemini VisionéŒ¯èª¤');}const d=await r.json();const txt=d.candidates?.[0]?.content?.parts?.[0]?.text;if(!txt)throw new Error('ç„¡å›æ‡‰');const m=txt.match(/\{[\s\S]*\}/);if(m)return JSON.parse(m[0]);throw new Error('è§£æå¤±æ•—');}else{const modelId=aiModelIds[settings.aiModel]||aiModelIds['llama4-scout'];const r=await fetch('https://api.groq.com/openai/v1/chat/completions',{method:'POST',headers:{'Content-Type':'application/json','Authorization':'Bearer '+settings.groqApiKey},body:JSON.stringify({model:modelId,messages:[{role:'user',content:[{type:'text',text:p},{type:'image_url',image_url:{url:imageBase64}}]}],temperature:0.8,max_tokens:1500})});if(!r.ok)throw new Error((await r.json()).error?.message||'VisionéŒ¯èª¤');const d=await r.json();const m=d.choices[0].message.content.match(/\{[\s\S]*\}/);if(m)return JSON.parse(m[0]);throw new Error('è§£æå¤±æ•—');}}
        function displayResult(r){document.getElementById('resultTitle').textContent=r.title||'å¤¢å¢ƒè§£æ';document.getElementById('resultTypeLabel').textContent=dreamTypeLabels[selectedDreamType]||'ä¸€èˆ¬';document.getElementById('scorePositive').textContent=r.scores?.positive||'--';document.getElementById('scorePsychology').textContent=r.scores?.psychology||'--';document.getElementById('scoreProphetic').textContent=r.scores?.prophetic||'--';document.getElementById('symbolMeaning').textContent=r.symbolMeaning||'';document.getElementById('psychoAnalysis').textContent=r.psychoAnalysis||'';document.getElementById('prediction').textContent=r.prediction||'';document.getElementById('luckyColor').textContent=r.lucky?.color||'--';document.getElementById('luckyNumber').textContent=r.lucky?.number||'--';document.getElementById('luckyTime').textContent=r.lucky?.time||'--';document.getElementById('luckyCharm').textContent=r.lucky?.charm||'--';updateTTSModeDisplay();}
        function resetDream(){stopSpeech();cachedSpeechText='';cachedAudioBlob=null;cachedTTSMode='';document.getElementById('dreamInput').value='';document.getElementById('charCount').textContent='0';fileContent='';imageBase64='';document.getElementById('fileInput').value='';document.getElementById('imageInput').value='';document.getElementById('filePreview').classList.remove('show');document.getElementById('imagePreview').classList.remove('show');document.getElementById('analyzeBtn').disabled=true;document.getElementById('analyzeBtn').style.display='block';document.getElementById('resultArea').classList.remove('show');document.getElementById('errorBox').classList.remove('show');dreamResult=null;showToast('ğŸ”„ å·²æ¸…é™¤');}
        function showError(m){document.getElementById('errorMessage').textContent=m;document.getElementById('errorBox').classList.add('show');}
        async function speakResult(){if(!dreamResult)return;stopSpeech();if(!cachedSpeechText){cachedSpeechText=`å¤¢å¢ƒè§£æï¼š${dreamResult.title}ã€‚è±¡å¾µï¼š${dreamResult.symbolMeaning}ã€‚å¿ƒç†ï¼š${dreamResult.psychoAnalysis}ã€‚å»ºè­°ï¼š${dreamResult.prediction}ã€‚å¹¸é‹é¡è‰²${dreamResult.lucky?.color}ï¼Œæ•¸å­—${dreamResult.lucky?.number}ï¼Œæ™‚è¾°${dreamResult.lucky?.time}ï¼Œè­·èº«${dreamResult.lucky?.charm}ã€‚`;}isPlaying=true;isPaused=false;updateVoiceButtons(true);if(settings.ttsMode==='web'){showToast('ğŸ”Š æ’­æ”¾ä¸­...');try{await speakWebSimple(cachedSpeechText);}catch(e){showToast('âŒ '+e.message);isPlaying=false;updateVoiceButtons(false);}}else if(cachedAudioBlob&&cachedTTSMode===settings.ttsMode){showToast('ğŸ”Š æ’­æ”¾ä¸­...');playAudioBlob(cachedAudioBlob);}else{showToast('ğŸ”„ è¼‰å…¥èªéŸ³...');try{if(settings.ttsMode==='gemini')await fetchGeminiAudio(cachedSpeechText);else await fetchElevenAudio(cachedSpeechText);showToast('ğŸ”Š æ’­æ”¾ä¸­...');playAudioBlob(cachedAudioBlob);}catch(e){showToast('âŒ '+e.message);isPlaying=false;updateVoiceButtons(false);}}}
        function speakWebSimple(t){return new Promise((res,rej)=>{if(!('speechSynthesis' in window)){rej(new Error('ä¸æ”¯æ´'));return;}currentUtterance=new SpeechSynthesisUtterance(t);currentUtterance.lang='zh-TW';currentUtterance.rate=0.9;currentUtterance.onend=()=>{isPlaying=false;isPaused=false;currentUtterance=null;updateVoiceButtons(false);if(!isStopping)showToast('âœ… å®Œæˆ');res();};currentUtterance.onerror=(e)=>{isPlaying=false;isPaused=false;currentUtterance=null;updateVoiceButtons(false);if(isStopping||e.error==='canceled'){res();}else{rej(new Error('WebèªéŸ³éŒ¯èª¤'));}};speechSynthesis.speak(currentUtterance);});}
        async function fetchGeminiAudio(t){if(!settings.geminiApiKey)throw new Error('è«‹è¨­å®šGemini Key');const r=await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-tts:generateContent?key=${settings.geminiApiKey}`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({contents:[{role:'user',parts:[{text:'è«‹ç”¨ä¸­æ–‡èªªï¼š'+t}]}],generationConfig:{responseModalities:['AUDIO'],speechConfig:{voiceConfig:{prebuiltVoiceConfig:{voiceName:settings.geminiVoice||'Aoede'}}}}})});if(!r.ok)throw new Error('GeminiéŒ¯èª¤');const d=await r.json();const a=d.candidates?.[0]?.content?.parts?.[0]?.inlineData?.data;if(!a)throw new Error('ç„¡éŸ³è¨Š');cachedAudioBlob=pcmToWav(a);cachedTTSMode='gemini';}
        async function fetchElevenAudio(t){if(!settings.elevenLabsApiKey)throw new Error('è«‹è¨­å®šElevenLabs Key');const vid=settings.elevenLabsCustomId||settings.elevenLabsVoice||'pFZP5JQG7iQjIQuC4Bku';const r=await fetch(`https://api.elevenlabs.io/v1/text-to-speech/${vid}`,{method:'POST',headers:{'Content-Type':'application/json','xi-api-key':settings.elevenLabsApiKey},body:JSON.stringify({text:t,model_id:'eleven_multilingual_v2',voice_settings:{stability:0.5,similarity_boost:0.75}})});if(!r.ok)throw new Error('ElevenLabséŒ¯èª¤');cachedAudioBlob=await r.blob();cachedTTSMode='elevenlabs';}
        function playAudioBlob(blob){currentAudio=new Audio(URL.createObjectURL(blob));currentAudio.onended=()=>{isPlaying=false;isPaused=false;currentAudio=null;updateVoiceButtons(false);if(!isStopping)showToast('âœ… å®Œæˆ');};currentAudio.onerror=()=>{if(!isStopping){isPlaying=false;isPaused=false;currentAudio=null;updateVoiceButtons(false);showToast('âŒ æ’­æ”¾éŒ¯èª¤');}};currentAudio.play();}
        function playAudioData(blob){return new Promise((res,rej)=>{currentAudio=new Audio(URL.createObjectURL(blob));currentAudio.onended=()=>{currentAudio=null;res();};currentAudio.onerror=()=>{currentAudio=null;rej(new Error('æ’­æ”¾éŒ¯èª¤'));};currentAudio.play().catch(rej);});}
        function pcmToWav(base64Pcm){const pcm=Uint8Array.from(atob(base64Pcm),c=>c.charCodeAt(0));const sampleRate=24000;const numChannels=1;const bitsPerSample=16;const byteRate=sampleRate*numChannels*bitsPerSample/8;const blockAlign=numChannels*bitsPerSample/8;const wavHeader=new ArrayBuffer(44);const view=new DataView(wavHeader);const writeString=(o,s)=>{for(let i=0;i<s.length;i++)view.setUint8(o+i,s.charCodeAt(i));};writeString(0,'RIFF');view.setUint32(4,36+pcm.length,true);writeString(8,'WAVE');writeString(12,'fmt ');view.setUint32(16,16,true);view.setUint16(20,1,true);view.setUint16(22,numChannels,true);view.setUint32(24,sampleRate,true);view.setUint32(28,byteRate,true);view.setUint16(32,blockAlign,true);view.setUint16(34,bitsPerSample,true);writeString(36,'data');view.setUint32(40,pcm.length,true);const wav=new Uint8Array(44+pcm.length);wav.set(new Uint8Array(wavHeader),0);wav.set(pcm,44);return new Blob([wav],{type:'audio/wav'});}
        function base64ToBlob(b,m){const c=atob(b);const a=new Uint8Array(c.length);for(let i=0;i<c.length;i++)a[i]=c.charCodeAt(i);return new Blob([a],{type:m});}
        function pauseSpeech(){if(!isPlaying)return;if(settings.ttsMode==='web'){if(speechSynthesis.speaking||speechSynthesis.paused){if(isPaused){speechSynthesis.resume();isPaused=false;document.getElementById('pauseBtn').textContent='â¸ï¸';showToast('â–¶ï¸ ç¹¼çºŒæ’­æ”¾');}else{speechSynthesis.pause();isPaused=true;document.getElementById('pauseBtn').textContent='â–¶ï¸';showToast('â¸ï¸ å·²æš«åœ');}}}else if(currentAudio){if(isPaused){currentAudio.play();isPaused=false;document.getElementById('pauseBtn').textContent='â¸ï¸';showToast('â–¶ï¸ ç¹¼çºŒæ’­æ”¾');}else{currentAudio.pause();isPaused=true;document.getElementById('pauseBtn').textContent='â–¶ï¸';showToast('â¸ï¸ å·²æš«åœ');}}}
        function stopSpeech(){isStopping=true;isPaused=false;isPlaying=false;if('speechSynthesis' in window){speechSynthesis.cancel();}currentUtterance=null;if(currentAudio){try{currentAudio.pause();currentAudio.src='';currentAudio=null;}catch(e){}}updateVoiceButtons(false);setTimeout(()=>{isStopping=false;},100);}
        function updateVoiceButtons(playing){const playBtn=document.getElementById('playBtn');const pauseBtn=document.getElementById('pauseBtn');const stopBtn=document.getElementById('stopBtn');if(playing){playBtn.textContent='ğŸ”Š æ’­æ”¾ä¸­';playBtn.disabled=true;pauseBtn.disabled=false;stopBtn.disabled=false;pauseBtn.textContent='â¸ï¸';}else{playBtn.textContent='â–¶ï¸ æ’­æ”¾';playBtn.disabled=false;pauseBtn.disabled=true;stopBtn.disabled=true;pauseBtn.textContent='â¸ï¸';}}
        function selectTTSMode(m){settings.ttsMode=m;document.querySelectorAll('.tts-mode[data-mode]').forEach(x=>x.classList.toggle('selected',x.dataset.mode===m));updateTTSSettingsVisibility();saveSettings();updateTTSModeDisplay();showToast('âœ… å·²åˆ‡æ›è‡³ '+getFullTTSName());}
        function updateTTSModeDisplay(){const el=document.getElementById('currentTTSMode');if(el)el.textContent=getFullTTSName();}
        function getFullTTSName(){if(settings.ttsMode==='web')return 'Web èªéŸ³';if(settings.ttsMode==='gemini')return 'Gemini - '+(geminiVoiceNames[settings.geminiVoice]||settings.geminiVoice).replace(/ğŸ‘© |ğŸ‘¨ /g,'');if(settings.ttsMode==='elevenlabs'){const vid=settings.elevenLabsCustomId||settings.elevenLabsVoice;return 'ElevenLabs - '+(elevenLabsVoiceNames[vid]||vid).replace(/ğŸ‘© |ğŸ‘¨ /g,'');}return 'Web';}
        function selectAIModel(m){if(paidModels.includes(m)){showPaidModal(m);return;}settings.aiModel=m;document.querySelectorAll('.tts-mode[data-model]').forEach(x=>x.classList.toggle('selected',x.dataset.model===m));saveSettings();showToast('âœ… æ¨¡å‹å·²åˆ‡æ›');}
        function showPaidModal(m){const modelName=m==='gemini-2.5-pro'?'Gemini 2.5 Pro':'Gemini 3.0 Pro';const modal=document.createElement('div');modal.id='paidModal';modal.innerHTML=`<div style="position:fixed;inset:0;background:rgba(0,0,0,0.8);display:flex;align-items:center;justify-content:center;z-index:9999;"><div style="background:linear-gradient(135deg,#1a0033,#0a0a1a);border:2px solid var(--neon-pink);border-radius:16px;padding:24px;max-width:320px;text-align:center;"><div style="font-size:48px;margin-bottom:12px;">ğŸ’°</div><div style="font-size:18px;font-weight:bold;color:var(--neon-cyan);margin-bottom:8px;">ä»˜è²»æ¨¡å‹æé†’</div><div style="font-size:14px;color:var(--text-secondary);margin-bottom:16px;line-height:1.6;"><strong style="color:var(--neon-pink);">${modelName}</strong> æ˜¯ä»˜è²»æ¨¡å‹<br><br>éœ€è¦åœ¨ Google AI Studio å•Ÿç”¨ä»˜è²»æ–¹æ¡ˆæ‰èƒ½ä½¿ç”¨<br><br><a href="https://aistudio.google.com/billing" target="_blank" style="color:var(--neon-cyan);">ğŸ‘‰ å‰å¾€è¨­å®šä»˜è²»</a></div><div style="display:flex;gap:10px;"><button onclick="confirmPaidModel('${m}')" style="flex:1;padding:12px;background:linear-gradient(135deg,var(--neon-pink),var(--neon-purple));border:none;border-radius:8px;color:white;font-weight:bold;cursor:pointer;">âœ… æˆ‘å·²ä»˜è²»ï¼Œç¹¼çºŒä½¿ç”¨</button></div><div style="margin-top:10px;"><button onclick="closePaidModal()" style="width:100%;padding:10px;background:transparent;border:1px solid var(--border-color);border-radius:8px;color:var(--text-secondary);cursor:pointer;">âŒ å–æ¶ˆ</button></div></div></div>`;document.body.appendChild(modal);}
        function confirmPaidModel(m){closePaidModal();settings.aiModel=m;document.querySelectorAll('.tts-mode[data-model]').forEach(x=>x.classList.toggle('selected',x.dataset.model===m));saveSettings();showToast('âœ… å·²åˆ‡æ›è‡³ '+m);}
        function closePaidModal(){const modal=document.getElementById('paidModal');if(modal)modal.remove();}
        function updateTTSSettingsVisibility(){document.getElementById('geminiSettings').style.display=settings.ttsMode==='gemini'?'block':'none';document.getElementById('elevenlabsSettings').style.display=settings.ttsMode==='elevenlabs'?'block':'none';document.getElementById('webSettings').style.display=settings.ttsMode==='web'?'block':'none';updateCurrentVoiceInfo();updateTTSModeDisplay();}
        function updateCurrentVoiceInfo(){const el=document.getElementById('currentVoiceInfo');if(settings.ttsMode==='web'){el.textContent='ğŸ”Š ç•¶å‰ï¼šWeb èªéŸ³ï¼ˆç€è¦½å™¨å…§å»ºï¼‰';el.style.color='var(--neon-cyan)';}else if(settings.ttsMode==='gemini'){el.textContent='ğŸ’ ç•¶å‰ï¼šGemini - '+(geminiVoiceNames[settings.geminiVoice]||settings.geminiVoice);el.style.color='var(--neon-pink)';}else{const vid=settings.elevenLabsCustomId||settings.elevenLabsVoice;el.textContent='ğŸ™ï¸ ç•¶å‰ï¼šElevenLabs - '+(elevenLabsVoiceNames[vid]||vid);el.style.color='var(--neon-purple)';}}
        async function testTTS(){const t='æ­¡è¿ä½¿ç”¨AIè§£å¤¢å¤§å¸«ï¼';showToast('ğŸ”Š æ¸¬è©¦...');try{if(settings.ttsMode==='web')await speakWithWeb(t);else if(settings.ttsMode==='gemini')await speakWithGemini(t);else await speakWithElevenLabs(t);}catch(e){showToast('âŒ '+e.message);}}
        async function testWebTTS(){stopSpeech();isPlaying=true;updateVoiceButtons(true);showToast('ğŸ”Š æ¸¬è©¦ Web èªéŸ³...');try{await speakWebSimple('æ­¡è¿ä½¿ç”¨AIè§£å¤¢å¤§å¸«');}catch(e){showToast('âŒ '+e.message);isPlaying=false;updateVoiceButtons(false);}}
        async function testGeminiTTS(){if(!document.getElementById('geminiApiKey').value){showToast('âš ï¸ è«‹å…ˆè¼¸å…¥ Gemini API Key');return;}stopSpeech();isPlaying=true;updateVoiceButtons(true);showToast('ğŸ’ è¼‰å…¥ Gemini èªéŸ³...');try{settings.geminiApiKey=document.getElementById('geminiApiKey').value;settings.geminiVoice=document.getElementById('geminiVoice').value;const r=await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-tts:generateContent?key=${settings.geminiApiKey}`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({contents:[{role:'user',parts:[{text:'è«‹ç”¨ä¸­æ–‡èªªï¼šæ­¡è¿ä½¿ç”¨AIè§£å¤¢å¤§å¸«'}]}],generationConfig:{responseModalities:['AUDIO'],speechConfig:{voiceConfig:{prebuiltVoiceConfig:{voiceName:settings.geminiVoice||'Aoede'}}}}})});if(!r.ok)throw new Error('GeminiéŒ¯èª¤');const d=await r.json();const a=d.candidates?.[0]?.content?.parts?.[0]?.inlineData?.data;if(!a)throw new Error('ç„¡éŸ³è¨Š');showToast('ğŸ”Š æ’­æ”¾ä¸­...');playAudioBlob(pcmToWav(a));}catch(e){showToast('âŒ '+e.message);isPlaying=false;updateVoiceButtons(false);}}
        async function testElevenLabsTTS(){if(!document.getElementById('elevenLabsApiKey').value){showToast('âš ï¸ è«‹å…ˆè¼¸å…¥ ElevenLabs API Key');return;}stopSpeech();isPlaying=true;updateVoiceButtons(true);showToast('ğŸ™ï¸ è¼‰å…¥ ElevenLabs èªéŸ³...');try{settings.elevenLabsApiKey=document.getElementById('elevenLabsApiKey').value;settings.elevenLabsVoice=document.getElementById('elevenLabsVoice').value;settings.elevenLabsCustomId=document.getElementById('elevenLabsCustomId').value;const vid=settings.elevenLabsCustomId||settings.elevenLabsVoice||'pFZP5JQG7iQjIQuC4Bku';const r=await fetch(`https://api.elevenlabs.io/v1/text-to-speech/${vid}`,{method:'POST',headers:{'Content-Type':'application/json','xi-api-key':settings.elevenLabsApiKey},body:JSON.stringify({text:'æ­¡è¿ä½¿ç”¨AIè§£å¤¢å¤§å¸«',model_id:'eleven_multilingual_v2',voice_settings:{stability:0.5,similarity_boost:0.75}})});if(!r.ok)throw new Error('ElevenLabséŒ¯èª¤');showToast('ğŸ”Š æ’­æ”¾ä¸­...');playAudioBlob(await r.blob());}catch(e){showToast('âŒ '+e.message);isPlaying=false;updateVoiceButtons(false);}}
        function saveGeminiSettings(){settings.geminiApiKey=document.getElementById('geminiApiKey').value.trim();settings.geminiVoice=document.getElementById('geminiVoice').value;localStorage.setItem('dreamSettingsMax',JSON.stringify(settings));updateCurrentVoiceInfo();updateTTSModeDisplay();showToast('ğŸ’¾ Gemini è¨­å®šå·²å„²å­˜');}
        function saveElevenLabsSettings(){settings.elevenLabsApiKey=document.getElementById('elevenLabsApiKey').value.trim();settings.elevenLabsVoice=document.getElementById('elevenLabsVoice').value;settings.elevenLabsCustomId=document.getElementById('elevenLabsCustomId').value.trim();localStorage.setItem('dreamSettingsMax',JSON.stringify(settings));updateCurrentVoiceInfo();updateTTSModeDisplay();showToast('ğŸ’¾ ElevenLabs è¨­å®šå·²å„²å­˜');}
        async function sendToLine(){if(!settings.gasUrl){showToast('âš ï¸ è«‹è¨­å®šGAS URL');return;}if(!dreamResult){showToast('âš ï¸ è«‹å…ˆè§£å¤¢');return;}showToast('ğŸ“¤ ç™¼é€ä¸­...');try{await fetch(settings.gasUrl,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({action:'sendDream',result:{...dreamResult,dreamType:dreamTypeLabels[selectedDreamType]}}),mode:'no-cors'});showToast('âœ… å·²ç™¼é€ï¼');}catch(e){showToast('âŒ å¤±æ•—');}}
        function saveDreamToHistory(t,r){dreamHistory.unshift({id:Date.now(),date:new Date().toLocaleString('zh-TW'),dreamText:t.substring(0,200),inputMode:currentInputMode,dreamType:selectedDreamType,result:r});if(dreamHistory.length>100)dreamHistory=dreamHistory.slice(0,100);localStorage.setItem('dreamHistory',JSON.stringify(dreamHistory));}
        function loadHistory(){const s=localStorage.getItem('dreamHistory');if(s)dreamHistory=JSON.parse(s);}
        function renderHistory(){const c=document.getElementById('historyList');document.getElementById('historyCount').textContent=dreamHistory.length+'ç­†';if(!dreamHistory.length){c.innerHTML='<div class="empty-state"><div class="icon">ğŸŒ™</div><p>å°šç„¡è¨˜éŒ„</p></div>';return;}const i={text:'âœï¸',file:'ğŸ“„',image:'ğŸ–¼ï¸'};c.innerHTML=dreamHistory.map(h=>`<div class="history-item" onclick="viewHistoryItem(${h.id})"><div class="date">${i[h.inputMode]||'âœï¸'} ${h.date}</div><div class="dream-preview">${h.result?.title||h.dreamText}</div><span class="type-tag">${dreamTypeLabels[h.dreamType]||'ä¸€èˆ¬'}</span></div>`).join('');}
        function viewHistoryItem(id){stopSpeech();cachedSpeechText='';cachedAudioBlob=null;cachedTTSMode='';const h=dreamHistory.find(x=>x.id===id);if(h){dreamResult=h.result;selectedDreamType=h.dreamType;document.querySelectorAll('.dream-type').forEach(t=>t.classList.toggle('selected',t.dataset.type===h.dreamType));displayResult(h.result);document.getElementById('analyzeBtn').style.display='none';document.getElementById('resultArea').classList.add('show');document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));document.querySelectorAll('.nav-item').forEach(n=>n.classList.remove('active'));document.getElementById('page-home').classList.add('active');document.querySelectorAll('.nav-item')[0].classList.add('active');}}
        function clearAllHistory(){if(confirm('ç¢ºå®šæ¸…é™¤ï¼Ÿ')){stopSpeech();dreamHistory=[];localStorage.removeItem('dreamHistory');renderHistory();showToast('ğŸ—‘ï¸ å·²æ¸…é™¤');}}
        function loadSettings(){const s=localStorage.getItem('dreamSettingsMax');if(s){Object.assign(settings,JSON.parse(s));document.getElementById('groqApiKey').value=settings.groqApiKey||'';document.getElementById('gasUrl').value=settings.gasUrl||'';document.getElementById('geminiApiKey').value=settings.geminiApiKey||'';document.getElementById('geminiVoice').value=settings.geminiVoice||'Aoede';document.getElementById('elevenLabsApiKey').value=settings.elevenLabsApiKey||'';document.getElementById('elevenLabsVoice').value=settings.elevenLabsVoice||'pFZP5JQG7iQjIQuC4Bku';document.getElementById('elevenLabsCustomId').value=settings.elevenLabsCustomId||'';document.querySelectorAll('.tts-mode[data-mode]').forEach(m=>m.classList.toggle('selected',m.dataset.mode===settings.ttsMode));document.querySelectorAll('.tts-mode[data-model]').forEach(m=>m.classList.toggle('selected',m.dataset.model===(settings.aiModel||'llama4-scout')));updateCurrentVoiceInfo();updateTTSModeDisplay();}}
        function saveSettings(){settings.groqApiKey=document.getElementById('groqApiKey').value.trim();settings.gasUrl=document.getElementById('gasUrl').value.trim();settings.geminiApiKey=document.getElementById('geminiApiKey').value.trim();settings.geminiVoice=document.getElementById('geminiVoice').value;settings.elevenLabsApiKey=document.getElementById('elevenLabsApiKey').value.trim();settings.elevenLabsVoice=document.getElementById('elevenLabsVoice').value;settings.elevenLabsCustomId=document.getElementById('elevenLabsCustomId').value.trim();localStorage.setItem('dreamSettingsMax',JSON.stringify(settings));checkApiStatus();checkCanAnalyze();updateCurrentVoiceInfo();showToast('âœ… å·²å„²å­˜');}
        function checkApiStatus(){const d=document.getElementById('groqStatus'),t=document.getElementById('groqStatusText');if(settings.groqApiKey?.startsWith('gsk_')){d.classList.add('active');t.textContent='å·²è¨­å®š';}else{d.classList.remove('active');t.textContent=settings.groqApiKey?'æ ¼å¼éŒ¯èª¤':'æœªè¨­å®š';}}
        async function testGroqAPI(){if(!settings.groqApiKey){showToast('âš ï¸ è«‹è¼¸å…¥Key');return;}showToast('ğŸ”— æ¸¬è©¦...');try{const r=await fetch('https://api.groq.com/openai/v1/chat/completions',{method:'POST',headers:{'Content-Type':'application/json','Authorization':'Bearer '+settings.groqApiKey},body:JSON.stringify({model:'llama-3.3-70b-versatile',messages:[{role:'user',content:'èªªOK'}],max_tokens:10})});showToast(r.ok?'âœ… æˆåŠŸï¼':'âŒ å¤±æ•—');}catch(e){showToast('âŒ éŒ¯èª¤');}}
        function showToast(m){const t=document.getElementById('toast');t.textContent=m;t.classList.add('show');setTimeout(()=>t.classList.remove('show'),2500);}
    </script>
</body>
</html>
